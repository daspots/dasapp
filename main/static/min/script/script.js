function followFunction(e,t){api_url="/api/v1/follow/"+t+"/",e.classList.contains("label-default")?e.classList.contains("not-logged-in")?($(".recommender").css({display:"none"}),$("#loginform").fadeIn()):(e.classList.remove("label-default"),e.classList.add("label-success"),e.innerHTML="FOLLOWING",$.ajax({url:api_url,type:"PUT",data:{},success:function(){}})):e.classList.contains("label-success")&&(e.classList.remove("label-success"),e.classList.add("label-default"),e.innerHTML="FOLLOW",$.ajax({url:api_url,type:"DELETE",success:function(e){}}))}function generateBox(e,t,i,n,o,r,s,a,l,u,c){return result='<div class="box" style="max-width:300px;"><img class="img-fluid" data-gifffer="',result+=e,result+='"><ul class="additionalLinks" style="margin-left:0px;padding-left:0px;padding-top:3px"><div><i class="fa fa-map-marker map-marker" aria-hidden="true"></i><a class="thumbnailLocation" href="',result+=t,result+='">',result+=i,result+='</a></div><li class="iconList"><h1 class="thumbnailTitle">',result+=n,result+='</h1></li></ul><div class="addPadding">',result+=o,result+="</div>",result+='<div class="tab"><br><a class="linkRecommendedBy" href="',result+=s,result+='"> BY '+r+"</a>",result+='<input id="',result+=a,result+='" class="hidden draaiknopje" type="checkbox" name="tabs">',result+='<label for="'+a+'">',result+='<ul class="additionalLinks" style="margin-left:0px;padding-left:0px;padding-top:10px">',result+='<li class="iconList"><a href="'+l+'"><img src="/p/img/ic_open_in_new_black_24px.png" class="postIcon"></a></li>',result+='<li class="iconList"><a href="'+c+'"><img src="/p/img/ic_directions_black_24px.png" class="postIcon"></a></li></ul>',result+="</label>",result+='<div class="tab-content">',result+='<p class="pLeft">'+u+"</p>",result+="</div></div></div>",result}function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function sanitizeHTML(e){for(var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},i=e[0],n=1;n<arguments.length;n++)i+=String(arguments[n]).replace(/[&<>'"]/g,function(e){return t[e]}),i+=e[n];return i}function getKeywordUrls(e,t){for(var i="",n=Math.min(3,t.length),o=0;o<n;o++)i+='<a class="thumbnailHashtag" href="',i+=e,i+=t[o],i+='">#',i+=t[o],i+="</a>";return console.log(i),i}function processPoints(e,t,i){e instanceof google.maps.LatLng?t.call(i,e):e instanceof google.maps.Data.Point?t.call(i,e.get()):e.getArray().forEach(function(e){processPoints(e,t,i)})}function initMap(){var e=new google.maps.Map(document.getElementsByClassName("map")[0],{zoom:7,center:{lat:0,lng:0}}),t=new google.maps.LatLngBounds;e.data.addListener("addfeature",function(i){processPoints(i.feature.getGeometry(),t.extend,t),e.fitBounds(t)}),console.log(query),api_url="/api/v1/post/"+query,e.data.loadGeoJson(api_url);var i=new google.maps.InfoWindow;i.setOptions({pixelOffset:new google.maps.Size(0,-30)}),e.data.addListener("click",function(t){var n=t.feature.getProperty("name"),o=t.feature.getProperty("description"),r=t.feature.getProperty("image_url"),s=t.feature.getProperty("location"),a="/post/q/"+s,l=getKeywordUrls("/post/q/",t.feature.getProperty("keywords").split(",")),u=t.feature.getProperty("recommender"),c="/post/q/recommender="+u,d=t.feature.getProperty("docid"),h=t.feature.getProperty("website"),p="https://www.google.com/maps?saddr=My+Location&daddr="+t.feature.getProperty("address").replace(" ","+"),m=t.feature.getGeometry().get(),f=generateBox(r,a,s,n,l,u,c,d,h,o,p);i.setContent(f),i.setPosition(m),i.open(e),Gifffer({playButtonStyles:{width:"60px",height:"60px","border-radius":"30px",background:"rgba(0, 0, 0, 0.3)",position:"absolute",top:"50%",left:"50%",margin:"-30px 0 0 -30px"},playButtonIconStyles:{width:"0",height:"0","border-top":"14px solid transparent","border-bottom":"14px solid transparent","border-left":"14px solid rgba(255,255,255, 0.5)",position:"absolute",left:"26px",top:"16px"}})})}function starFunction(e,t){api_url="/api/v1/star/"+t+"/",e.classList.contains("fa-star-o")?e.classList.contains("not-logged-in")?($("#restaurant").css({display:"none"}),$("#loginform").fadeIn()):(e.classList.remove("fa-star-o"),e.classList.add("fa-star"),$.ajax({url:api_url,type:"PUT",data:{},success:function(){}})):e.classList.contains("fa-star")&&(e.classList.remove("fa-star"),e.classList.add("fa-star-o"),$.ajax({url:api_url,type:"DELETE",success:function(e){}}))}(function(){window.api_call=function(e,t,i,n,o){var r,s;o=o||n||i,n=n||i,4===arguments.length&&(n=void 0),3===arguments.length&&(i=void 0,n=void 0),i=i||{};for(r in i)null==i[r]&&delete i[r];return s=t.search("\\?")>=0?"&":"?",$.ajax({type:e,url:""+t+s+$.param(i),contentType:"application/json",accepts:"application/json",dataType:"json",data:n?JSON.stringify(n):void 0,success:function(t){var i;return"success"===t.status?(i=void 0,t.next_url&&(i=function(i){return api_call(e,t.next_url,{},i)}),"function"==typeof o?o(void 0,t.result,i):void 0):"function"==typeof o?o(t):void 0},error:function(e,t,i){var n;n={error_code:"ajax_error",text_status:t,error_thrown:i,jqXHR:e};try{e.responseText&&(n=$.parseJSON(e.responseText))}catch(e){e,n=n}return LOG("api_call error",n),"function"==typeof o?o(n):void 0}})}}).call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};window.FileUploader=function(){function i(t){var i,n;this.options=t,this.upload_file=e(this.upload_file,this),this.process_files=e(this.process_files,this),this.get_upload_urls=e(this.get_upload_urls,this),this.upload_files=e(this.upload_files,this),this.file_select_handler=e(this.file_select_handler,this),this.file_drag_hover=e(this.file_drag_hover,this),this.upload_handler=this.options.upload_handler,this.selector=this.options.selector,this.drop_area=this.options.drop_area,this.upload_url=this.options.upload_url||"/api/v1"+window.location.pathname,this.confirm_message=this.options.confirm_message||"Files are still being uploaded.",this.allowed_types=this.options.allowed_types,this.max_size=this.options.max_size,this.active_files=0,null!=(i=this.selector)&&i.bind("change",function(e){return function(t){return e.file_select_handler(t)}}(this)),n=new XMLHttpRequest,null!=this.drop_area&&n.upload&&(this.drop_area.on("dragover",this.file_drag_hover),this.drop_area.on("dragleave",this.file_drag_hover),this.drop_area.on("drop",function(e){return function(t){return e.file_select_handler(t)}}(this)),this.drop_area.show()),window.onbeforeunload=function(e){return function(){if(null!=e.confirm_message&&e.active_files>0)return e.confirm_message}}(this)}return i.prototype.file_drag_hover=function(e){if(null!=this.drop_area)return e.stopPropagation(),e.preventDefault(),"dragover"===e.type?this.drop_area.addClass("drag-hover"):this.drop_area.removeClass("drag-hover")},i.prototype.file_select_handler=function(e){var t,i,n,o;if(this.file_drag_hover(e),(null!=(t=(null!=(i=e.originalEvent.dataTransfer)?i.files:void 0)||(null!=(n=e.target)?n.files:void 0)||(null!=(o=e.dataTransfer)?o.files:void 0))?t.length:void 0)>0)return this.upload_files(t)},i.prototype.upload_files=function(e){return this.get_upload_urls(e.length,function(t){return function(i,n){if(!i)return t.process_files(e,n,0);console.log("Error getting URLs",i)}}(this))},i.prototype.get_upload_urls=function(e,t){if(!(e<=0))return api_call("GET",this.upload_url,{count:e},function(e,i){if(e)throw t(e),e;return t(void 0,i)})},i.prototype.process_files=function(e,t,i){var n;if(!(i>=e.length))return this.upload_file(e[i],t[i].upload_url,null!=(n=this.upload_handler)?n.preview(e[i]):void 0,function(n){return function(){return n.process_files(e,t,i+1,null!=n.upload_handler)}}(this))},i.prototype.upload_file=function(e,i,n,o){var r,s,a,l;return l=new XMLHttpRequest,(null!=(s=this.allowed_types)?s.length:void 0)>0&&(a=e.type,t.call(this.allowed_types,a)<0)?(n(0,void 0,"wrong_type"),void o()):null!=this.max_size&&e.size>this.max_size?(n(0,void 0,"too_big"),void o()):(l.upload.addEventListener("progress",function(e){return n(parseInt(e.loaded/e.total*100))}),l.onreadystatechange=function(e){return function(t){var i;if(4===l.readyState)return 200===l.status?(i=JSON.parse(l.responseText),n(100,i.result),$("#image").val($("#image").val()+i.result.id+";"),e.active_files-=1):(n(0,void 0,"error"),e.active_files-=1)}}(this),l.open("POST",i,!0),(r=new FormData).append("file",e),l.send(r),o())},i}()}.call(this),function(){window.LOG=function(){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,arguments):void 0},window.init_common=function(){return init_loading_button(),init_confirm_button(),init_password_show_button(),init_time(),init_announcement(),init_row_link()},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.init_confirm_button=function(){return $("body").on("click",".btn-confirm",function(){if(!confirm($(this).data("message")||"Are you sure?"))return event.preventDefault()})},window.init_password_show_button=function(){return $("body").on("click",".btn-password-show",function(){var e;return(e=$($(this).data("target"))).focus(),$(this).hasClass("active")?e.attr("type","password"):e.attr("type","text")})},window.init_time=function(){if($("time").length>0)return function(){return $("time[datetime]").each(function(){var e;return e=moment.utc($(this).attr("datetime")),moment().diff(e,"days")>25?$(this).text(e.local().format("YYYY-MM-DD")):$(this).text(e.fromNow()),$(this).attr("title",e.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(arguments.callee,45e3)}()},window.init_announcement=function(){if($(".alert-announcement button.close").click(function(){return"undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.setItem("closedAnnouncement",$(".alert-announcement").html()):void 0}),("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("closedAnnouncement"):void 0)!==$(".alert-announcement").html())return $(".alert-announcement").show()},window.init_row_link=function(){return $("body").on("click",".row-link",function(){return window.location.href=$(this).data("href")}),$("body").on("click",".not-link",function(e){return e.stopPropagation()})},window.clear_notifications=function(){return $("#notifications").empty()},window.show_notification=function(e,t){if(null==t&&(t="warning"),clear_notifications(),e)return $("#notifications").append('<div class="alert alert-dismissable alert-'+t+'">\n  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n  '+e+"\n</div>")},window.size_human=function(e){var t,i,n,o;for(t=0,i=(n=["B","KB","MB","GB","TB"]).length;t<i;t++){if(o=n[t],e<1e3)return"B"===o?e+" "+o:parseInt(10*e)/10+" "+o;e/=1024}}}.call(this),function(){$(function(){return init_common()}),$(function(){return $("html.auth").each(function(){return init_auth()})}),$(function(){return $("html.user-list").each(function(){return init_user_list()})}),$(function(){return $("html.user-merge").each(function(){return init_user_merge()})}),$(function(){return $("html.resource-list").each(function(){return init_resource_list()})}),$(function(){return $("html.resource-view").each(function(){return init_resource_view()})}),$(function(){return $("html.post-create").each(function(){return init_resource_upload()})}),$(function(){return $("html.recommender-create").each(function(){return init_resource_upload()})})}.call(this),function(){window.init_auth=function(){return $(".remember").change(function(){var e,t,i,n,o,r;for(r=[],n=0,o=(t=$(".btn-social").toArray().concat($(".btn-social-icon").toArray())).length;n<o;n++)e=t[n],i=$(e).prop("href"),$(".remember input").is(":checked")?($(e).prop("href",i+"&remember=true"),r.push($("#remember").prop("checked",!0))):($(e).prop("href",i.replace("&remember=true","")),r.push($("#remember").prop("checked",!1)));return r}),$(".remember").change()}}.call(this),function(){$(".pretty-file").length&&$(".pretty-file").each(function(){var e,t;return t=$(this),(e=t.find('input[type="file"]')).hide(),e.change(function(){var i,n,o;return i=e[0].files,n="",n=i.length>1?i.length+" files selected":(o=e.val().split("\\"))[o.length-1],t.find(".input-group input").val(n)}),t.find(".input-group").click(function(t){return t.preventDefault(),e.click(),$(this).blur()})})}.call(this),function(){var e;window.init_resource_list=function(){return init_delete_resource_button()},window.init_resource_view=function(){return init_delete_resource_button()},window.init_resource_upload=function(){if(window.File&&window.FileList&&window.FileReader)return window.file_uploader=new FileUploader({upload_handler:e,selector:$(".file"),drop_area:$(".drop-area"),confirm_message:"Files are still being uploaded.",upload_url:$(".file").data("get-upload-url"),allowed_types:[],max_size:1073741824})},e={preview:function(e){var t,i,n;return i=$('<div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">\n  <div class="thumbnail">\n    <div class="preview"></div>\n    <h5>'+e.name+'</h5>\n    <div class="progress">\n      <div class="progress-bar" style="width: 0%;"></div>\n      <div class="progress-text"></div>\n    </div>\n  </div>\n</div>'),t=$(".preview",i),file_uploader.active_files<16&&0===e.type.indexOf("image")?((n=new FileReader).onload=function(e){return t.css("background-image","url("+e.target.result+")")},n.readAsDataURL(e)):t.text(e.type||"application/octet-stream"),$(".resource-uploads").prepend(i),function(n,o,r){return r?($(".progress-bar",i).css("width","100%"),$(".progress-bar",i).addClass("progress-bar-danger"),void("too_big"===r?$(".progress-text",i).text("Failed! Too big, max: "+size_human(file_uploader.max_size)+"."):"wrong_type"===r?$(".progress-text",i).text("Failed! Wrong file type."):$(".progress-text",i).text("Failed!"))):100===n&&o?($(".progress-bar",i).addClass("progress-bar-success"),$(".progress-text",i).text("Success "+size_human(e.size)),o.image_url&&t.text().length>0?(t.css("background-image","url("+o.image_url+")"),t.text("")):void 0):100===n?($(".progress-bar",i).css("width","100%"),$(".progress-text",i).text("100% - Processing..")):($(".progress-bar",i).css("width",n+"%"),$(".progress-text",i).text(n+"% of "+size_human(e.size)))}}},window.init_delete_resource_button=function(){return $("body").on("click",".btn-delete",function(e){if(e.preventDefault(),confirm("Press OK to delete the resource"))return $(this).attr("disabled","disabled"),api_call("DELETE",$(this).data("api-url"),function(e){return function(t,i){var n,o;return t?($(e).removeAttr("disabled"),void LOG("Something went terribly wrong during delete!",t)):(o=$(e).data("target"),n=$(e).data("redirect-url"),o&&$(""+o).remove(),n?window.location.href=n:void 0)}}(this))})}}.call(this),function(){var e,t,i,n,o,r;window.init_user_list=function(){return i(),e(),t()},i=function(){return $("input[name=user_db]").each(function(){return r($(this))}),$("#select-all").change(function(){return $("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){return r($(this))})}),$("input[name=user_db]").change(function(){return r($(this))})},r=function(e){return o(),$("input[name=user_db]").each(function(){var t;return t=e.val(),$("#"+t).toggleClass("warning",e.is(":checked"))})},o=function(){var e;return e=$("input[name=user_db]:checked").length,$("#user-actions").toggleClass("hidden",0===e),$("#user-merge").toggleClass("hidden",e<2),0===e?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},e=function(){return $("#user-delete").click(function(e){var t,i,n,r,s;if(clear_notifications(),e.preventDefault(),t=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length),confirm(t))return s=[],$("input[name=user_db]:checked").each(function(){return $(this).attr("disabled",!0),s.push($(this).val())}),i=$(this).data("api-url"),r=$(this).data("success"),n=$(this).data("error"),api_call("DELETE",i,{user_keys:s.join(",")},function(e,t){return e?($("input[name=user_db]:disabled").removeAttr("disabled"),void show_notification(n.replace("{users}",s.length),"danger")):$("#"+t.join(", #")).fadeOut(function(){return $(this).remove(),o(),show_notification(r.replace("{users}",s.length),"success")})})})},window.init_user_merge=function(){var e,t;return t=$("#user_keys").val(),e=$(".api-url").data("api-url"),api_call("GET",e,{user_keys:t},function(e,t){if(!e)return window.user_dbs=t,$("input[name=user_db]").removeAttr("disabled");LOG("Something went terribly wrong")}),$("input[name=user_db]").change(function(e){var t;return t=$(e.currentTarget).val(),n(t)})},n=function(e){var t,i,n,o;for($(".user-row").removeClass("success").addClass("danger"),$("#"+e).removeClass("danger").addClass("success"),n=[],t=0,i=user_dbs.length;t<i;t++){if(o=user_dbs[t],e===o.key){$("input[name=user_key]").val(o.key),$("input[name=username]").val(o.username),$("input[name=name]").val(o.name),$("input[name=email]").val(o.email);break}n.push(void 0)}return n},t=function(){return $("#user-merge").click(function(e){var t,i;return e.preventDefault(),t=[],$("input[name=user_db]:checked").each(function(){return t.push($(this).val())}),i=$(this).data("user-merge-url"),window.location.href=i+"?user_keys="+t.join(",")})}}.call(this),$(".close-icon").on("click",function(){$(this).closest(".card").css({display:"none"}),$(".recommender").fadeIn()});var keywords=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:"/keywords",filter:function(e){return $.map(e,function(e){return{name:e}})}}});keywords.initialize(),$("#search").typeahead(null,{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}),$("#search_page").typeahead(null,{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}),$("#keywords").tagsinput({confirmKeys:[13,44],typeaheadjs:[{minLength:1,highlight:!0},{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}],freeInput:!0}),$("#location_keywords").tagsinput({confirmKeys:[13,44],typeaheadjs:[{minLength:1,highlight:!0},{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}],freeInput:!0}),$(".draaiknopje").click(function(){setTimeout(function(){$(".grid").masonry("layout")},100)}),$(document).ready(function(){Gifffer({playButtonStyles:{width:"60px",height:"60px","border-radius":"30px",background:"rgba(0, 0, 0, 0.3)",position:"absolute",top:"50%",left:"50%",margin:"-30px 0 0 -30px"},playButtonIconStyles:{width:"0",height:"0","border-top":"14px solid transparent","border-bottom":"14px solid transparent","border-left":"14px solid rgba(255,255,255, 0.5)",position:"absolute",left:"26px",top:"16px"}}),$(".grid").masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0}),$(".grid").imagesLoaded().progress(function(){$(".grid").masonry("layout")})});var _templateObject=_taggedTemplateLiteral(['<div class="box scrollFix"><img class="img-fluid" data-gifffer="','"><ul class="additionalLinks" style="margin-left:0px;padding-left:0px;padding-top:3px"><div><i class="fa fa-map-marker map-marker" aria-hidden="true"></i><a class="thumbnailLocation" href="','">','</a></div><li class="iconList"><h1 class="thumbnailTitle">','</h1></li></ul><div class="addPadding">',"</div>"],['<div style="margin-bottom:20px;"><h2>',"</h2><p>",'</p><p><img class="img-fluid" data-gifffer="','"></p></div>']);$(".map_link").on("click",function(){$("#restaurant").css({display:"none"}),$("#map").fadeIn(),initMap(),$("a.lista").css({color:"gray"}),$("a.mapa").css({color:"black"})}),$(".list_link").on("click",function(){$("#map").css({display:"none"}),$("#restaurant").fadeIn(),$("a.lista").css({color:"black"}),$("a.mapa").css({color:"gray"})}),function(e,t){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.jQueryBridget=t(e,e.jQuery)}(window,function(e,t){"use strict";function i(i,r,a){function l(e,t,n){var o,r="$()."+i+'("'+t+'")';return e.each(function(e,l){var u=a.data(l,i);if(u){var c=u[t];if(c&&"_"!=t.charAt(0)){var d=c.apply(u,n);o=void 0===o?d:o}else s(r+" is not a valid method")}else s(i+" not initialized. Cannot call methods, i.e. "+r)}),void 0!==o?o:e}function u(e,t){e.each(function(e,n){var o=a.data(n,i);o?(o.option(t),o._init()):(o=new r(n,t),a.data(n,i,o))})}(a=a||t||e.jQuery)&&(r.prototype.option||(r.prototype.option=function(e){a.isPlainObject(e)&&(this.options=a.extend(!0,this.options,e))}),a.fn[i]=function(e){return"string"==typeof e?l(this,e,o.call(arguments,1)):(u(this,e),this)},n(a))}function n(e){!e||e&&e.bridget||(e.bridget=i)}var o=Array.prototype.slice,r=e.console,s=void 0===r?function(){}:function(e){r.error(e)};return n(t||e.jQuery),i}),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return-1==n.indexOf(t)&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{};return(i[e]=i[e]||{})[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return-1!=n&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=0,o=i[n];t=t||[];for(var r=this._onceEvents&&this._onceEvents[e];o;){var s=r&&r[o];s&&(this.off(e,o),delete r[o]),o.apply(this,t),o=i[n+=s?0:1]}return this}},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return t()}):"object"==typeof module&&module.exports?module.exports=t():e.getSize=t()}(window,function(){"use strict";function e(e){var t=parseFloat(e);return-1==e.indexOf("%")&&!isNaN(t)&&t}function t(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;l>t;t++)e[a[t]]=0;return e}function i(e){var t=getComputedStyle(e);return t||s("Style returned "+t+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),t}function n(){if(!u){u=!0;var t=document.createElement("div");t.style.width="200px",t.style.padding="1px 2px 3px 4px",t.style.borderStyle="solid",t.style.borderWidth="1px 2px 3px 4px",t.style.boxSizing="border-box";var n=document.body||document.documentElement;n.appendChild(t);var s=i(t);o.isBoxSizeOuter=r=200==e(s.width),n.removeChild(t)}}function o(o){if(n(),"string"==typeof o&&(o=document.querySelector(o)),o&&"object"==typeof o&&o.nodeType){var s=i(o);if("none"==s.display)return t();var u={};u.width=o.offsetWidth,u.height=o.offsetHeight;for(var c=u.isBorderBox="border-box"==s.boxSizing,d=0;l>d;d++){var h=a[d],p=s[h],m=parseFloat(p);u[h]=isNaN(m)?0:m}var f=u.paddingLeft+u.paddingRight,g=u.paddingTop+u.paddingBottom,v=u.marginLeft+u.marginRight,y=u.marginTop+u.marginBottom,_=u.borderLeftWidth+u.borderRightWidth,b=u.borderTopWidth+u.borderBottomWidth,x=c&&r,C=e(s.width);!1!==C&&(u.width=C+(x?0:f+_));var w=e(s.height);return!1!==w&&(u.height=w+(x?0:g+b)),u.innerWidth=u.width-(f+_),u.innerHeight=u.height-(g+b),u.outerWidth=u.width+v,u.outerHeight=u.height+y,u}}var r,s="undefined"==typeof console?function(){}:function(e){console.error(e)},a=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],l=a.length,u=!1;return o}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",t):"object"==typeof module&&module.exports?module.exports=t():e.matchesSelector=t()}(window,function(){"use strict";var e=function(){var e=window.Element.prototype;if(e.matches)return"matches";if(e.matchesSelector)return"matchesSelector";for(var t=["webkit","moz","ms","o"],i=0;i<t.length;i++){var n=t[i]+"MatchesSelector";if(e[n])return n}}();return function(t,i){return t[e](i)}}),function(e,t){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("desandro-matches-selector")):e.fizzyUIUtils=t(e,e.matchesSelector)}(window,function(e,t){var i={};i.extend=function(e,t){for(var i in t)e[i]=t[i];return e},i.modulo=function(e,t){return(e%t+t)%t},i.makeArray=function(e){var t=[];if(Array.isArray(e))t=e;else if(e&&"object"==typeof e&&"number"==typeof e.length)for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e);return t},i.removeFrom=function(e,t){var i=e.indexOf(t);-1!=i&&e.splice(i,1)},i.getParent=function(e,i){for(;e!=document.body;)if(e=e.parentNode,t(e,i))return e},i.getQueryElement=function(e){return"string"==typeof e?document.querySelector(e):e},i.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},i.filterFindElements=function(e,n){var o=[];return(e=i.makeArray(e)).forEach(function(e){if(e instanceof HTMLElement){if(!n)return void o.push(e);t(e,n)&&o.push(e);for(var i=e.querySelectorAll(n),r=0;r<i.length;r++)o.push(i[r])}}),o},i.debounceMethod=function(e,t,i){var n=e.prototype[t],o=t+"Timeout";e.prototype[t]=function(){var e=this[o];e&&clearTimeout(e);var t=arguments,r=this;this[o]=setTimeout(function(){n.apply(r,t),delete r[o]},i||100)}},i.docReady=function(e){var t=document.readyState;"complete"==t||"interactive"==t?setTimeout(e):document.addEventListener("DOMContentLoaded",e)},i.toDashed=function(e){return e.replace(/(.)([A-Z])/g,function(e,t,i){return t+"-"+i}).toLowerCase()};var n=e.console;return i.htmlInit=function(t,o){i.docReady(function(){var r=i.toDashed(o),s="data-"+r,a=document.querySelectorAll("["+s+"]"),l=document.querySelectorAll(".js-"+r),u=i.makeArray(a).concat(i.makeArray(l)),c=s+"-options",d=e.jQuery;u.forEach(function(e){var i,r=e.getAttribute(s)||e.getAttribute(c);try{i=r&&JSON.parse(r)}catch(t){return void(n&&n.error("Error parsing "+s+" on "+e.className+": "+t))}var a=new t(e,i);d&&d.data(e,o,a)})})},i}),function(e,t){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("ev-emitter"),require("get-size")):(e.Outlayer={},e.Outlayer.Item=t(e.EvEmitter,e.getSize))}(window,function(e,t){"use strict";function i(e){for(var t in e)return!1;return null,!0}function n(e,t){e&&(this.element=e,this.layout=t,this.position={x:0,y:0},this._create())}var o=document.documentElement.style,r="string"==typeof o.transition?"transition":"WebkitTransition",s="string"==typeof o.transform?"transform":"WebkitTransform",a={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],l={transform:s,transition:r,transitionDuration:r+"Duration",transitionProperty:r+"Property",transitionDelay:r+"Delay"},u=n.prototype=Object.create(e.prototype);u.constructor=n,u._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},u.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},u.getSize=function(){this.size=t(this.element)},u.css=function(e){var t=this.element.style;for(var i in e)t[l[i]||i]=e[i]},u.getPosition=function(){var e=getComputedStyle(this.element),t=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),n=e[t?"left":"right"],o=e[i?"top":"bottom"],r=this.layout.size,s=-1!=n.indexOf("%")?parseFloat(n)/100*r.width:parseInt(n,10),a=-1!=o.indexOf("%")?parseFloat(o)/100*r.height:parseInt(o,10);s=isNaN(s)?0:s,a=isNaN(a)?0:a,s-=t?r.paddingLeft:r.paddingRight,a-=i?r.paddingTop:r.paddingBottom,this.position.x=s,this.position.y=a},u.layoutPosition=function(){var e=this.layout.size,t={},i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop"),o=i?"paddingLeft":"paddingRight",r=i?"left":"right",s=i?"right":"left",a=this.position.x+e[o];t[r]=this.getXValue(a),t[s]="";var l=n?"paddingTop":"paddingBottom",u=n?"top":"bottom",c=n?"bottom":"top",d=this.position.y+e[l];t[u]=this.getYValue(d),t[c]="",this.css(t),this.emitEvent("layout",[this])},u.getXValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!t?e/this.layout.size.width*100+"%":e+"px"},u.getYValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&t?e/this.layout.size.height*100+"%":e+"px"},u._transitionTo=function(e,t){this.getPosition();var i=this.position.x,n=this.position.y,o=parseInt(e,10),r=parseInt(t,10),s=o===this.position.x&&r===this.position.y;if(this.setPosition(e,t),!s||this.isTransitioning){var a=e-i,l=t-n,u={};u.transform=this.getTranslate(a,l),this.transition({to:u,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},u.getTranslate=function(e,t){var i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop");return e=i?e:-e,t=n?t:-t,"translate3d("+e+"px, "+t+"px, 0)"},u.goTo=function(e,t){this.setPosition(e,t),this.layoutPosition()},u.moveTo=u._transitionTo,u.setPosition=function(e,t){this.position.x=parseInt(e,10),this.position.y=parseInt(t,10)},u._nonTransition=function(e){this.css(e.to),e.isCleaning&&this._removeStyles(e.to);for(var t in e.onTransitionEnd)e.onTransitionEnd[t].call(this)},u.transition=function(e){if(parseFloat(this.layout.options.transitionDuration)){var t=this._transn;for(var i in e.onTransitionEnd)t.onEnd[i]=e.onTransitionEnd[i];for(i in e.to)t.ingProperties[i]=!0,e.isCleaning&&(t.clean[i]=!0);if(e.from){this.css(e.from);this.element.offsetHeight;null}this.enableTransition(e.to),this.css(e.to),this.isTransitioning=!0}else this._nonTransition(e)};var c="opacity,"+function(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}(s);u.enableTransition=function(){if(!this.isTransitioning){var e=this.layout.options.transitionDuration;e="number"==typeof e?e+"ms":e,this.css({transitionProperty:c,transitionDuration:e,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(a,this,!1)}},u.onwebkitTransitionEnd=function(e){this.ontransitionend(e)},u.onotransitionend=function(e){this.ontransitionend(e)};var d={"-webkit-transform":"transform"};u.ontransitionend=function(e){if(e.target===this.element){var t=this._transn,n=d[e.propertyName]||e.propertyName;delete t.ingProperties[n],i(t.ingProperties)&&this.disableTransition(),n in t.clean&&(this.element.style[e.propertyName]="",delete t.clean[n]),n in t.onEnd&&(t.onEnd[n].call(this),delete t.onEnd[n]),this.emitEvent("transitionEnd",[this])}},u.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(a,this,!1),this.isTransitioning=!1},u._removeStyles=function(e){var t={};for(var i in e)t[i]="";this.css(t)};var h={transitionProperty:"",transitionDuration:"",transitionDelay:""};return u.removeTransitionStyles=function(){this.css(h)},u.stagger=function(e){e=isNaN(e)?0:e,this.staggerDelay=e+"ms"},u.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},u.remove=function(){return r&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},u.reveal=function(){delete this.isHidden,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:e.hiddenStyle,to:e.visibleStyle,isCleaning:!0,onTransitionEnd:t})},u.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},u.getHideRevealTransitionEndProperty=function(e){var t=this.layout.options[e];if(t.opacity)return"opacity";for(var i in t)return i},u.hide=function(){this.isHidden=!0,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:e.visibleStyle,to:e.hiddenStyle,isCleaning:!0,onTransitionEnd:t})},u.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},u.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},n}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(i,n,o,r){return t(e,i,n,o,r)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):e.Outlayer=t(e,e.EvEmitter,e.getSize,e.fizzyUIUtils,e.Outlayer.Item)}(window,function(e,t,i,n,o){"use strict";function r(e,t){var i=n.getQueryElement(e);if(i){this.element=i,u&&(this.$element=u(this.element)),this.options=n.extend({},this.constructor.defaults),this.option(t);var o=++d;this.element.outlayerGUID=o,h[o]=this,this._create(),this._getOption("initLayout")&&this.layout()}else l&&l.error("Bad element for "+this.constructor.namespace+": "+(i||e))}function s(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}function a(e){if("number"==typeof e)return e;var t=e.match(/(^\d*\.?\d*)(\w*)/),i=t&&t[1],n=t&&t[2];return i.length?(i=parseFloat(i))*(m[n]||1):0}var l=e.console,u=e.jQuery,c=function(){},d=0,h={};r.namespace="outlayer",r.Item=o,r.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var p=r.prototype;n.extend(p,t.prototype),p.option=function(e){n.extend(this.options,e)},p._getOption=function(e){var t=this.constructor.compatOptions[e];return t&&void 0!==this.options[t]?this.options[t]:this.options[e]},r.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},p._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),n.extend(this.element.style,this.options.containerStyle),this._getOption("resize")&&this.bindResize()},p.reloadItems=function(){this.items=this._itemize(this.element.children)},p._itemize=function(e){for(var t=this._filterFindItemElements(e),i=this.constructor.Item,n=[],o=0;o<t.length;o++){var r=new i(t[o],this);n.push(r)}return n},p._filterFindItemElements=function(e){return n.filterFindElements(e,this.options.itemSelector)},p.getItemElements=function(){return this.items.map(function(e){return e.element})},p.layout=function(){this._resetLayout(),this._manageStamps();var e=this._getOption("layoutInstant"),t=void 0!==e?e:!this._isLayoutInited;this.layoutItems(this.items,t),this._isLayoutInited=!0},p._init=p.layout,p._resetLayout=function(){this.getSize()},p.getSize=function(){this.size=i(this.element)},p._getMeasurement=function(e,t){var n,o=this.options[e];o?("string"==typeof o?n=this.element.querySelector(o):o instanceof HTMLElement&&(n=o),this[e]=n?i(n)[t]:o):this[e]=0},p.layoutItems=function(e,t){e=this._getItemsForLayout(e),this._layoutItems(e,t),this._postLayout()},p._getItemsForLayout=function(e){return e.filter(function(e){return!e.isIgnored})},p._layoutItems=function(e,t){if(this._emitCompleteOnItems("layout",e),e&&e.length){var i=[];e.forEach(function(e){var n=this._getItemLayoutPosition(e);n.item=e,n.isInstant=t||e.isLayoutInstant,i.push(n)},this),this._processLayoutQueue(i)}},p._getItemLayoutPosition=function(){return{x:0,y:0}},p._processLayoutQueue=function(e){this.updateStagger(),e.forEach(function(e,t){this._positionItem(e.item,e.x,e.y,e.isInstant,t)},this)},p.updateStagger=function(){var e=this.options.stagger;return null===e||void 0===e?void(this.stagger=0):(this.stagger=a(e),this.stagger)},p._positionItem=function(e,t,i,n,o){n?e.goTo(t,i):(e.stagger(o*this.stagger),e.moveTo(t,i))},p._postLayout=function(){this.resizeContainer()},p.resizeContainer=function(){if(this._getOption("resizeContainer")){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},p._getContainerSize=c,p._setContainerMeasure=function(e,t){if(void 0!==e){var i=this.size;i.isBorderBox&&(e+=t?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),e=Math.max(e,0),this.element.style[t?"width":"height"]=e+"px"}},p._emitCompleteOnItems=function(e,t){function i(){o.dispatchEvent(e+"Complete",null,[t])}function n(){++s==r&&i()}var o=this,r=t.length;if(t&&r){var s=0;t.forEach(function(t){t.once(e,n)})}else i()},p.dispatchEvent=function(e,t,i){var n=t?[t].concat(i):i;if(this.emitEvent(e,n),u)if(this.$element=this.$element||u(this.element),t){var o=u.Event(t);o.type=e,this.$element.trigger(o,i)}else this.$element.trigger(e,i)},p.ignore=function(e){var t=this.getItem(e);t&&(t.isIgnored=!0)},p.unignore=function(e){var t=this.getItem(e);t&&delete t.isIgnored},p.stamp=function(e){(e=this._find(e))&&(this.stamps=this.stamps.concat(e),e.forEach(this.ignore,this))},p.unstamp=function(e){(e=this._find(e))&&e.forEach(function(e){n.removeFrom(this.stamps,e),this.unignore(e)},this)},p._find=function(e){return e?("string"==typeof e&&(e=this.element.querySelectorAll(e)),e=n.makeArray(e)):void 0},p._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},p._getBoundingRect=function(){var e=this.element.getBoundingClientRect(),t=this.size;this._boundingRect={left:e.left+t.paddingLeft+t.borderLeftWidth,top:e.top+t.paddingTop+t.borderTopWidth,right:e.right-(t.paddingRight+t.borderRightWidth),bottom:e.bottom-(t.paddingBottom+t.borderBottomWidth)}},p._manageStamp=c,p._getElementOffset=function(e){var t=e.getBoundingClientRect(),n=this._boundingRect,o=i(e);return{left:t.left-n.left-o.marginLeft,top:t.top-n.top-o.marginTop,right:n.right-t.right-o.marginRight,bottom:n.bottom-t.bottom-o.marginBottom}},p.handleEvent=n.handleEvent,p.bindResize=function(){e.addEventListener("resize",this),this.isResizeBound=!0},p.unbindResize=function(){e.removeEventListener("resize",this),this.isResizeBound=!1},p.onresize=function(){this.resize()},n.debounceMethod(r,"onresize",100),p.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},p.needsResizeLayout=function(){var e=i(this.element);return this.size&&e&&e.innerWidth!==this.size.innerWidth},p.addItems=function(e){var t=this._itemize(e);return t.length&&(this.items=this.items.concat(t)),t},p.appended=function(e){var t=this.addItems(e);t.length&&(this.layoutItems(t,!0),this.reveal(t))},p.prepended=function(e){var t=this._itemize(e);if(t.length){var i=this.items.slice(0);this.items=t.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(t,!0),this.reveal(t),this.layoutItems(i)}},p.reveal=function(e){if(this._emitCompleteOnItems("reveal",e),e&&e.length){var t=this.updateStagger();e.forEach(function(e,i){e.stagger(i*t),e.reveal()})}},p.hide=function(e){if(this._emitCompleteOnItems("hide",e),e&&e.length){var t=this.updateStagger();e.forEach(function(e,i){e.stagger(i*t),e.hide()})}},p.revealItemElements=function(e){var t=this.getItems(e);this.reveal(t)},p.hideItemElements=function(e){var t=this.getItems(e);this.hide(t)},p.getItem=function(e){for(var t=0;t<this.items.length;t++){var i=this.items[t];if(i.element==e)return i}},p.getItems=function(e){var t=[];return(e=n.makeArray(e)).forEach(function(e){var i=this.getItem(e);i&&t.push(i)},this),t},p.remove=function(e){var t=this.getItems(e);this._emitCompleteOnItems("remove",t),t&&t.length&&t.forEach(function(e){e.remove(),n.removeFrom(this.items,e)},this)},p.destroy=function(){var e=this.element.style;e.height="",e.position="",e.width="",this.items.forEach(function(e){e.destroy()}),this.unbindResize();var t=this.element.outlayerGUID;delete h[t],delete this.element.outlayerGUID,u&&u.removeData(this.element,this.constructor.namespace)},r.data=function(e){var t=(e=n.getQueryElement(e))&&e.outlayerGUID;return t&&h[t]},r.create=function(e,t){var i=s(r);return i.defaults=n.extend({},r.defaults),n.extend(i.defaults,t),i.compatOptions=n.extend({},r.compatOptions),i.namespace=e,i.data=r.data,i.Item=s(o),n.htmlInit(i,e),u&&u.bridget&&u.bridget(e,i),i};var m={ms:1,s:1e3};return r.Item=o,r}),function(e,t){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("outlayer"),require("get-size")):e.Masonry=t(e.Outlayer,e.getSize)}(window,function(e,t){var i=e.create("masonry");i.compatOptions.fitWidth="isFitWidth";var n=i.prototype;return n._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var e=0;e<this.cols;e++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},n.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var e=this.items[0],i=e&&e.element;this.columnWidth=i&&t(i).outerWidth||this.containerWidth}var n=this.columnWidth+=this.gutter,o=this.containerWidth+this.gutter,r=o/n,s=n-o%n,a=s&&1>s?"round":"floor";r=Math[a](r),this.cols=Math.max(r,1)},n.getContainerWidth=function(){var e=this._getOption("fitWidth")?this.element.parentNode:this.element,i=t(e);this.containerWidth=i&&i.innerWidth},n._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth%this.columnWidth,i=t&&1>t?"round":"ceil",n=Math[i](e.size.outerWidth/this.columnWidth);n=Math.min(n,this.cols);for(var o=this[this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition"](n,e),r={x:this.columnWidth*o.col,y:o.y},s=o.y+e.size.outerHeight,a=n+o.col,l=o.col;a>l;l++)this.colYs[l]=s;return r},n._getTopColPosition=function(e){var t=this._getTopColGroup(e),i=Math.min.apply(Math,t);return{col:t.indexOf(i),y:i}},n._getTopColGroup=function(e){if(2>e)return this.colYs;for(var t=[],i=this.cols+1-e,n=0;i>n;n++)t[n]=this._getColGroupY(n,e);return t},n._getColGroupY=function(e,t){if(2>t)return this.colYs[e];var i=this.colYs.slice(e,e+t);return Math.max.apply(Math,i)},n._getHorizontalColPosition=function(e,t){var i=this.horizontalColIndex%this.cols;i=e>1&&i+e>this.cols?0:i;var n=t.size.outerWidth&&t.size.outerHeight;return this.horizontalColIndex=n?i+e:this.horizontalColIndex,{col:i,y:this._getColGroupY(i,e)}},n._manageStamp=function(e){var i=t(e),n=this._getElementOffset(e),o=this._getOption("originLeft")?n.left:n.right,r=o+i.outerWidth,s=Math.floor(o/this.columnWidth);s=Math.max(0,s);var a=Math.floor(r/this.columnWidth);a-=r%this.columnWidth?0:1,a=Math.min(this.cols-1,a);for(var l=(this._getOption("originTop")?n.top:n.bottom)+i.outerHeight,u=s;a>=u;u++)this.colYs[u]=Math.max(l,this.colYs[u])},n._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var e={height:this.maxY};return this._getOption("fitWidth")&&(e.width=this._getContainerFitWidth()),e},n._getContainerFitWidth=function(){for(var e=0,t=this.cols;--t&&0===this.colYs[t];)e++;return(this.cols-e)*this.columnWidth-this.gutter},n.needsResizeLayout=function(){var e=this.containerWidth;return this.getContainerWidth(),e!=this.containerWidth},i}),$(".close-icon").on("click",function(){$(this).closest(".card").css({display:"none"}),$("#restaurant").fadeIn()})(function(e){"use strict";var t=function(t,i){var n=this,o={allowFreeEntries:!0,allowDuplicates:!1,ajaxConfig:{},autoSelect:!0,selectFirst:!1,queryParam:"query",beforeSend:function(){},cls:"",data:null,dataUrlParams:{},disabled:!1,disabledField:null,displayField:"name",editable:!0,expanded:!1,expandOnFocus:!1,groupBy:null,hideTrigger:!1,highlight:!0,id:null,infoMsgCls:"",inputCfg:{},invalidCls:"ms-inv",matchCase:!1,maxDropHeight:290,maxEntryLength:null,maxEntryRenderer:function(e){return"Please reduce your entry by "+e+" character"+(e>1?"s":"")},maxSuggestions:null,maxSelection:10,maxSelectionRenderer:function(e){return"You cannot choose more than "+e+" item"+(e>1?"s":"")},method:"POST",minChars:0,minCharsRenderer:function(e){return"Please type "+e+" more character"+(e>1?"s":"")},mode:"local",name:null,noSuggestionText:"No suggestions",placeholder:"Type or click here",renderer:null,required:!1,resultAsString:!1,resultAsStringDelimiter:",",resultsField:"results",selectionCls:"",selectionContainer:null,selectionPosition:"inner",selectionRenderer:null,selectionStacked:!1,sortDir:"asc",sortOrder:null,strictSuggest:!1,style:"",toggleOnClick:!1,typeDelay:400,useTabKey:!1,useCommaKey:!0,useZebraStyle:!1,value:null,valueField:"id",vregex:null,vtype:null},r=e.extend({},i),s=e.extend(!0,{},o,r);this.addToSelection=function(t,i){if(!s.maxSelection||l.length<s.maxSelection){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,i){(s.allowDuplicates||-1===e.inArray(i[s.valueField],n.getValue()))&&(l.push(i),o=!0)}),!0===o&&(f._renderSelection(),this.empty(),!0!==i&&e(this).trigger("selectionchange",[this,this.getSelection()]))}this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.clear=function(e){this.removeFromSelection(l.slice(0),e)},this.collapse=function(){!0===s.expanded&&(this.combobox.detach(),s.expanded=!1,e(this).trigger("collapse",[this]))},this.disable=function(){this.container.addClass("ms-ctn-disabled"),s.disabled=!0,n.input.attr("disabled",!0)},this.empty=function(){this.input.val("")},this.enable=function(){this.container.removeClass("ms-ctn-disabled"),s.disabled=!1,n.input.attr("disabled",!1)},this.expand=function(){!s.expanded&&(this.input.val().length>=s.minChars||this.combobox.children().size()>0)&&(this.combobox.appendTo(this.container),f._processSuggestions(),s.expanded=!0,e(this).trigger("expand",[this]))},this.isDisabled=function(){return s.disabled},this.isValid=function(){var t=!1===s.required||l.length>0;return(s.vtype||s.vregex)&&e.each(l,function(e,i){t=t&&f._validateSingleItem(i[s.valueField])}),t},this.getDataUrlParams=function(){return s.dataUrlParams},this.getName=function(){return s.name},this.getSelection=function(){return l},this.getRawValue=function(){return n.input.val()},this.getValue=function(){return e.map(l,function(e){return e[s.valueField]})},this.removeFromSelection=function(t,i){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,i){var r=e.inArray(i[s.valueField],n.getValue());r>-1&&(l.splice(r,1),o=!0)}),!0===o&&(f._renderSelection(),!0!==i&&e(this).trigger("selectionchange",[this,this.getSelection()]),s.expandOnFocus&&n.expand(),s.expanded&&f._processSuggestions()),this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.getData=function(){return h},this.setData=function(e){s.data=e,f._processSuggestions()},this.setName=function(t){s.name=t,t&&(s.name+=t.indexOf("[]")>0?"":"[]"),n._valueContainer&&e.each(n._valueContainer.children(),function(e,t){t.name=s.name})},this.setSelection=function(e){this.clear(),this.addToSelection(e)},this.setValue=function(t){var i=[];e.each(t,function(t,n){var o=!1;if(e.each(h,function(e,t){if(t[s.valueField]==n)return i.push(t),o=!0,!1}),!o)if("object"==typeof n)i.push(n);else{var r={};r[s.valueField]=n,r[s.displayField]=n,i.push(r)}}),i.length>0&&this.addToSelection(i)},this.setDataUrlParams=function(t){s.dataUrlParams=e.extend({},t)};var a,l=[],u=0,c=!1,d=null,h=[],p=!1,m={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESC:27,SPACE:32,UPARROW:38,DOWNARROW:40,COMMA:188},f={_displaySuggestions:function(t){n.combobox.show(),n.combobox.empty();var i=0,o=0;if(null===d)f._renderComboItems(t),i=u*t.length;else{for(var r in d)o+=1,e("<div/>",{class:"ms-res-group",html:r}).appendTo(n.combobox),f._renderComboItems(d[r].items,!0);var a=n.combobox.find(".ms-res-group").outerHeight();if(null!==a){var l=o*a;i=u*t.length+l}else i=u*(t.length+o)}if(i<n.combobox.height()||i<=s.maxDropHeight?n.combobox.height(i):i>=n.combobox.height()&&i>s.maxDropHeight&&n.combobox.height(s.maxDropHeight),1===t.length&&!0===s.autoSelect&&n.combobox.children().filter(":not(.ms-res-item-disabled):last").addClass("ms-res-item-active"),!0===s.selectFirst&&n.combobox.children().filter(":not(.ms-res-item-disabled):first").addClass("ms-res-item-active"),0===t.length&&""!==n.getRawValue()){var c=s.noSuggestionText.replace(/\{\{.*\}\}/,n.input.val());f._updateHelper(c),n.collapse()}!1===s.allowFreeEntries&&(0===t.length?(e(n.input).addClass(s.invalidCls),n.combobox.hide()):e(n.input).removeClass(s.invalidCls))},_getEntriesFromStringArray:function(t){var i=[];return e.each(t,function(t,n){var o={};o[s.displayField]=o[s.valueField]=e.trim(n),i.push(o)}),i},_highlightSuggestion:function(t){var i=n.input.val(),o=["^","$","*","+","?",".","(",")",":","!","|","{","}","[","]"];if(e.each(o,function(e,t){i=i.replace(t,"\\"+t)}),0===i.length)return t;var r=!0===s.matchCase?"g":"gi";return t.replace(new RegExp("("+i+")(?!([^<]+)?>)",r),"<em>$1</em>")},_moveSelectedRow:function(e){s.expanded||n.expand();var t,i,o,r;t=n.combobox.find(".ms-res-item:not(.ms-res-item-disabled)"),i="down"===e?t.eq(0):t.filter(":last"),(o=n.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0&&("down"===e?(0===(i=o.nextAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(i=t.eq(0)),r=n.combobox.scrollTop(),n.combobox.scrollTop(0),i[0].offsetTop+i.outerHeight()>n.combobox.height()&&n.combobox.scrollTop(r+u)):(0===(i=o.prevAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(i=t.filter(":last"),n.combobox.scrollTop(u*t.length)),i[0].offsetTop<n.combobox.scrollTop()&&n.combobox.scrollTop(n.combobox.scrollTop()-u))),t.removeClass("ms-res-item-active"),i.addClass("ms-res-item-active")},_processSuggestions:function(t){var i=null,o=t||s.data;if(null!==o){if("function"==typeof o&&(o=o.call(n,n.getRawValue())),"string"==typeof o){e(n).trigger("beforeload",[n]);var r={};r[s.queryParam]=n.input.val();var a=e.extend(r,s.dataUrlParams);return void e.ajax(e.extend({type:s.method,url:o,data:a,beforeSend:s.beforeSend,success:function(t){i="string"==typeof t?JSON.parse(t):t,f._processSuggestions(i),e(n).trigger("load",[n,i]),f._asyncValues&&(n.setValue("string"==typeof f._asyncValues?JSON.parse(f._asyncValues):f._asyncValues),f._renderSelection(),delete f._asyncValues)},error:function(){throw"Could not reach server"}},s.ajaxConfig))}h=o.length>0&&"string"==typeof o[0]?f._getEntriesFromStringArray(o):o[s.resultsField]||o;var l="remote"===s.mode?h:f._sortAndTrim(h);f._displaySuggestions(f._group(l))}},_render:function(t){if(n.setName(s.name),n.container=e("<div/>",{class:"ms-ctn form-control "+(s.resultAsString?"ms-as-string ":"")+s.cls+(e(t).hasClass("input-lg")?" input-lg":"")+(e(t).hasClass("input-sm")?" input-sm":"")+(!0===s.disabled?" ms-ctn-disabled":"")+(!0===s.editable?"":" ms-ctn-readonly")+(!1===s.hideTrigger?"":" ms-no-trigger"),style:s.style,id:s.id}),n.container.focus(e.proxy(g._onFocus,this)),n.container.blur(e.proxy(g._onBlur,this)),n.container.keydown(e.proxy(g._onKeyDown,this)),n.container.keyup(e.proxy(g._onKeyUp,this)),n.input=e("<input/>",e.extend({type:"text",class:!0===s.editable?"":" ms-input-readonly",readonly:!s.editable,placeholder:s.placeholder,disabled:s.disabled},s.inputCfg)),n.input.focus(e.proxy(g._onInputFocus,this)),n.input.click(e.proxy(g._onInputClick,this)),n.combobox=e("<div/>",{class:"ms-res-ctn dropdown-menu"}).height(s.maxDropHeight),n.combobox.on("click","div.ms-res-item",e.proxy(g._onComboItemSelected,this)),n.combobox.on("mouseover","div.ms-res-item",e.proxy(g._onComboItemMouseOver,this)),s.selectionContainer?(n.selectionContainer=s.selectionContainer,e(n.selectionContainer).addClass("ms-sel-ctn")):n.selectionContainer=e("<div/>",{class:"ms-sel-ctn"}),n.selectionContainer.click(e.proxy(g._onFocus,this)),"inner"!==s.selectionPosition||s.selectionContainer?n.container.append(n.input):n.selectionContainer.append(n.input),n.helper=e("<span/>",{class:"ms-helper "+s.infoMsgCls}),f._updateHelper(),n.container.append(n.helper),e(t).replaceWith(n.container),!s.selectionContainer)switch(s.selectionPosition){case"bottom":n.selectionContainer.insertAfter(n.container),!0===s.selectionStacked&&(n.selectionContainer.width(n.container.width()),n.selectionContainer.addClass("ms-stacked"));break;case"right":n.selectionContainer.insertAfter(n.container),n.container.css("float","left");break;default:n.container.append(n.selectionContainer)}!1===s.hideTrigger&&(n.trigger=e("<div/>",{class:"ms-trigger",html:'<div class="ms-trigger-ico"></div>'}),n.trigger.click(e.proxy(g._onTriggerClick,this)),n.container.append(n.trigger)),e(window).resize(e.proxy(g._onWindowResized,this)),null===s.value&&null===s.data||("string"==typeof s.data?(f._asyncValues=s.value,f._processSuggestions()):(f._processSuggestions(),null!==s.value&&(n.setValue(s.value),f._renderSelection()))),e("body").click(function(e){n.container.hasClass("ms-ctn-focus")&&0===n.container.has(e.target).length&&e.target.className.indexOf("ms-res-item")<0&&e.target.className.indexOf("ms-close-btn")<0&&n.container[0]!==e.target&&g._onBlur()}),!0===s.expanded&&(s.expanded=!1,n.expand())},_renderComboItems:function(t,i){var o=this,r="";e.each(t,function(t,n){var a=null!==s.renderer?s.renderer.call(o,n):n[s.displayField],l=null!==s.disabledField&&!0===n[s.disabledField],u=e("<div/>",{class:"ms-res-item "+(i?"ms-res-item-grouped ":"")+(l?"ms-res-item-disabled ":"")+(t%2==1&&!0===s.useZebraStyle?"ms-res-odd":""),html:!0===s.highlight?f._highlightSuggestion(a):a,"data-json":JSON.stringify(n)});r+=e("<div/>").append(u).html()}),n.combobox.append(r),u=n.combobox.find(".ms-res-item:first").outerHeight()},_renderSelection:function(){var t=this,i=0,o=0,r=[],a=!0===s.resultAsString&&!c;n.selectionContainer.find(".ms-sel-item").remove(),void 0!==n._valueContainer&&n._valueContainer.remove(),e.each(l,function(i,n){var o,u=null!==s.selectionRenderer?s.selectionRenderer.call(t,n):n[s.displayField],c=f._validateSingleItem(n[s.displayField])?"":" ms-sel-invalid";!0===a?o=e("<div/>",{class:"ms-sel-item ms-sel-text "+s.selectionCls+c,html:u+(i===l.length-1?"":s.resultAsStringDelimiter)}).data("json",n):(o=e("<div/>",{class:"ms-sel-item "+s.selectionCls+c,html:u}).data("json",n),!1===s.disabled&&e("<span/>",{class:"ms-close-btn"}).data("json",n).appendTo(o).click(e.proxy(g._onTagTriggerClick,t))),r.push(o)}),n.selectionContainer.prepend(r),n._valueContainer=e("<div/>",{style:"display: none;"}),e.each(n.getValue(),function(t,i){e("<input/>",{type:"hidden",name:s.name,value:i}).appendTo(n._valueContainer)}),n._valueContainer.appendTo(n.selectionContainer),"inner"!==s.selectionPosition||s.selectionContainer||(n.input.width(0),o=n.input.offset().left-n.selectionContainer.offset().left,i=n.container.width()-o-42,n.input.width(i)),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):n.helper.hide()},_selectItem:function(e){1===s.maxSelection&&(l=[]),n.addToSelection(e.data("json")),e.removeClass("ms-res-item-active"),!1!==s.expandOnFocus&&l.length!==s.maxSelection||n.collapse(),c?c&&(s.expandOnFocus||p)&&(f._processSuggestions(),p&&n.expand()):n.input.focus()},_sortAndTrim:function(t){var i=n.getRawValue(),o=[],r=[],a=n.getValue();return i.length>0?e.each(t,function(e,t){var n=t[s.displayField];(!0===s.matchCase&&n.indexOf(i)>-1||!1===s.matchCase&&n.toLowerCase().indexOf(i.toLowerCase())>-1)&&(!1!==s.strictSuggest&&0!==n.toLowerCase().indexOf(i.toLowerCase())||o.push(t))}):o=t,e.each(o,function(t,i){(s.allowDuplicates||-1===e.inArray(i[s.valueField],a))&&r.push(i)}),null!==s.sortOrder&&r.sort(function(e,t){return e[s.sortOrder]<t[s.sortOrder]?"asc"===s.sortDir?-1:1:e[s.sortOrder]>t[s.sortOrder]?"asc"===s.sortDir?1:-1:0}),s.maxSuggestions&&s.maxSuggestions>0&&(r=r.slice(0,s.maxSuggestions)),r},_group:function(t){return null!==s.groupBy&&(d={},e.each(t,function(e,t){var i=s.groupBy.indexOf(".")>-1?s.groupBy.split("."):s.groupBy,n=t[s.groupBy];if("string"!=typeof i)for(n=t;i.length>0;)n=n[i.shift()];void 0===d[n]?d[n]={title:n,items:[t]}:d[n].items.push(t)})),t},_updateHelper:function(e){n.helper.html(e),n.helper.is(":visible")||n.helper.fadeIn()},_validateSingleItem:function(e){if(null!==s.vregex&&s.vregex instanceof RegExp)return s.vregex.test(e);if(null!==s.vtype)switch(s.vtype){case"alpha":return/^[a-zA-Z_]+$/.test(e);case"alphanum":return/^[a-zA-Z0-9_]+$/.test(e);case"email":return/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/.test(e);case"url":return/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i.test(e);case"ipaddress":return/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)}return!0}},g={_onBlur:function(){if(n.container.removeClass("ms-ctn-focus"),n.collapse(),c=!1,""!==n.getRawValue()&&!0===s.allowFreeEntries){var t={};t[s.displayField]=t[s.valueField]=n.getRawValue().trim(),n.addToSelection(t)}f._renderSelection(),!1===n.isValid()?n.container.addClass(s.invalidCls):""!==n.input.val()&&!1===s.allowFreeEntries&&(n.empty(),f._updateHelper("")),e(n).trigger("blur",[n])},_onComboItemMouseOver:function(t){var i=e(t.currentTarget);i.hasClass("ms-res-item-disabled")||(n.combobox.children().removeClass("ms-res-item-active"),i.addClass("ms-res-item-active"))},_onComboItemSelected:function(t){e(t.currentTarget).hasClass("ms-res-item-disabled")||f._selectItem(e(t.currentTarget))},_onFocus:function(){n.input.focus()},_onInputClick:function(){!1===n.isDisabled()&&c&&!0===s.toggleOnClick&&(s.expanded?n.collapse():n.expand())},_onInputFocus:function(){if(!1===n.isDisabled()&&!c){c=!0,n.container.addClass("ms-ctn-focus"),n.container.removeClass(s.invalidCls);var t=n.getRawValue().length;!0===s.expandOnFocus&&n.expand(),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):t<s.minChars&&f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t)),f._renderSelection(),e(n).trigger("focus",[n])}},_onKeyDown:function(t){var i=n.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first"),o=n.input.val();if(e(n).trigger("keydown",[n,t]),t.keyCode!==m.TAB||!1!==s.useTabKey&&(!0!==s.useTabKey||0!==i.length||0!==n.input.val().length))switch(t.keyCode){case m.BACKSPACE:0===o.length&&n.getSelection().length>0&&"inner"===s.selectionPosition&&(l.pop(),f._renderSelection(),e(n).trigger("selectionchange",[n,n.getSelection()]),n.input.attr("placeholder","inner"===s.selectionPosition&&n.getValue().length>0?"":s.placeholder),n.input.focus(),t.preventDefault());break;case m.TAB:case m.ESC:t.preventDefault();break;case m.ENTER:(""!==o||s.expanded)&&t.preventDefault();break;case m.COMMA:!0===s.useCommaKey&&t.preventDefault();break;case m.CTRL:p=!0;break;case m.DOWNARROW:t.preventDefault(),f._moveSelectedRow("down");break;case m.UPARROW:t.preventDefault(),f._moveSelectedRow("up");break;default:l.length===s.maxSelection&&t.preventDefault()}else g._onBlur()},_onKeyUp:function(t){var i,o=n.getRawValue(),r=e.trim(n.input.val()).length>0&&(!s.maxEntryLength||e.trim(n.input.val()).length<=s.maxEntryLength),u={};if(e(n).trigger("keyup",[n,t]),clearTimeout(a),t.keyCode===m.ESC&&s.expanded&&n.combobox.hide(),t.keyCode===m.TAB&&!1===s.useTabKey||t.keyCode>m.ENTER&&t.keyCode<m.SPACE)t.keyCode===m.CTRL&&(p=!1);else switch(t.keyCode){case m.UPARROW:case m.DOWNARROW:t.preventDefault();break;case m.ENTER:case m.TAB:case m.COMMA:if(t.keyCode!==m.COMMA||!0===s.useCommaKey){if(t.preventDefault(),!0===s.expanded&&(i=n.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0)return void f._selectItem(i);!0===r&&!0===s.allowFreeEntries&&(u[s.displayField]=u[s.valueField]=o.trim(),n.addToSelection(u),n.collapse(),n.input.focus());break}default:l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):o.length<s.minChars?(f._updateHelper(s.minCharsRenderer.call(this,s.minChars-o.length)),!0===s.expanded&&n.collapse()):s.maxEntryLength&&o.length>s.maxEntryLength?(f._updateHelper(s.maxEntryRenderer.call(this,o.length-s.maxEntryLength)),!0===s.expanded&&n.collapse()):(n.helper.hide(),s.minChars<=o.length&&(a=setTimeout(function(){!0===s.expanded?f._processSuggestions():n.expand()},s.typeDelay)))}},_onTagTriggerClick:function(t){n.removeFromSelection(e(t.currentTarget).data("json"))},_onTriggerClick:function(){if(!1===n.isDisabled()&&(!0!==s.expandOnFocus||l.length!==s.maxSelection))if(e(n).trigger("triggerclick",[n]),!0===s.expanded)n.collapse();else{var t=n.getRawValue().length;t>=s.minChars?(n.input.focus(),n.expand()):f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t))}},_onWindowResized:function(){f._renderSelection()}};null!==t&&f._render(t)};e.fn.magicSuggest=function(i){var n=e(this);return 1===n.size()&&n.data("magicSuggest")?n.data("magicSuggest"):(n.each(function(n){var o=e(this);if(!o.data("magicSuggest")){"select"===this.nodeName.toLowerCase()&&(i.data=[],i.value=[],e.each(this.children,function(t,n){n.nodeName&&"option"===n.nodeName.toLowerCase()&&(i.data.push({id:n.value,name:n.text}),e(n).attr("selected")&&i.value.push(n.value))}));var r={};e.each(this.attributes,function(e,t){r[t.name]="value"===t.name&&""!==t.value?JSON.parse(t.value):t.value});var s=new t(this,e.extend([],e.fn.magicSuggest.defaults,i,r));o.data("magicSuggest",s),s.container.data("magicSuggest",s)}}),1===n.size()?n.data("magicSuggest"):n)},e.fn.magicSuggest.defaults={}})(jQuery),function(e){"use strict";var t=function(t,i){var n=this,o={allowFreeEntries:!0,allowDuplicates:!1,ajaxConfig:{},autoSelect:!0,selectFirst:!1,queryParam:"query",beforeSend:function(){},cls:"",data:null,dataUrlParams:{},disabled:!1,disabledField:null,displayField:"name",editable:!0,expanded:!1,expandOnFocus:!1,groupBy:null,hideTrigger:!1,highlight:!0,id:null,infoMsgCls:"",inputCfg:{},invalidCls:"ms-inv",matchCase:!1,maxDropHeight:290,maxEntryLength:null,maxEntryRenderer:function(e){return"Please reduce your entry by "+e+" character"+(e>1?"s":"")},maxSuggestions:null,maxSelection:10,maxSelectionRenderer:function(e){return"You cannot choose more than "+e+" item"+(e>1?"s":"")},method:"POST",minChars:0,minCharsRenderer:function(e){return"Please type "+e+" more character"+(e>1?"s":"")},mode:"local",name:null,noSuggestionText:"No suggestions",placeholder:"Type or click here",renderer:null,required:!1,resultAsString:!1,resultAsStringDelimiter:",",resultsField:"results",selectionCls:"",selectionContainer:null,selectionPosition:"inner",selectionRenderer:null,selectionStacked:!1,sortDir:"asc",sortOrder:null,strictSuggest:!1,style:"",toggleOnClick:!1,typeDelay:400,useTabKey:!1,useCommaKey:!0,useZebraStyle:!1,value:null,valueField:"id",vregex:null,vtype:null},r=e.extend({},i),s=e.extend(!0,{},o,r);this.addToSelection=function(t,i){if(!s.maxSelection||l.length<s.maxSelection){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,i){(s.allowDuplicates||-1===e.inArray(i[s.valueField],n.getValue()))&&(l.push(i),o=!0)}),!0===o&&(f._renderSelection(),this.empty(),!0!==i&&e(this).trigger("selectionchange",[this,this.getSelection()]))}this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.clear=function(e){this.removeFromSelection(l.slice(0),e)},this.collapse=function(){!0===s.expanded&&(this.combobox.detach(),s.expanded=!1,e(this).trigger("collapse",[this]))},this.disable=function(){this.container.addClass("ms-ctn-disabled"),s.disabled=!0,n.input.attr("disabled",!0)},this.empty=function(){this.input.val("")},this.enable=function(){this.container.removeClass("ms-ctn-disabled"),s.disabled=!1,n.input.attr("disabled",!1)},this.expand=function(){!s.expanded&&(this.input.val().length>=s.minChars||this.combobox.children().size()>0)&&(this.combobox.appendTo(this.container),f._processSuggestions(),s.expanded=!0,e(this).trigger("expand",[this]))},this.isDisabled=function(){return s.disabled},this.isValid=function(){var t=!1===s.required||l.length>0;return(s.vtype||s.vregex)&&e.each(l,function(e,i){t=t&&f._validateSingleItem(i[s.valueField])}),t},this.getDataUrlParams=function(){return s.dataUrlParams},this.getName=function(){return s.name},this.getSelection=function(){return l},this.getRawValue=function(){return n.input.val()},this.getValue=function(){return e.map(l,function(e){return e[s.valueField]})},this.removeFromSelection=function(t,i){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,i){var r=e.inArray(i[s.valueField],n.getValue());r>-1&&(l.splice(r,1),o=!0)}),!0===o&&(f._renderSelection(),!0!==i&&e(this).trigger("selectionchange",[this,this.getSelection()]),s.expandOnFocus&&n.expand(),s.expanded&&f._processSuggestions()),this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.getData=function(){return h},this.setData=function(e){s.data=e,f._processSuggestions()},this.setName=function(t){s.name=t,t&&(s.name+=t.indexOf("[]")>0?"":"[]"),n._valueContainer&&e.each(n._valueContainer.children(),function(e,t){t.name=s.name})},this.setSelection=function(e){this.clear(),this.addToSelection(e)},this.setValue=function(t){var i=[];e.each(t,function(t,n){var o=!1;if(e.each(h,function(e,t){if(t[s.valueField]==n)return i.push(t),o=!0,!1}),!o)if("object"==typeof n)i.push(n);else{var r={};r[s.valueField]=n,r[s.displayField]=n,i.push(r)}}),i.length>0&&this.addToSelection(i)},this.setDataUrlParams=function(t){s.dataUrlParams=e.extend({},t)};var a,l=[],u=0,c=!1,d=null,h=[],p=!1,m={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESC:27,SPACE:32,UPARROW:38,DOWNARROW:40,COMMA:188},f={_displaySuggestions:function(t){n.combobox.show(),n.combobox.empty();var i=0,o=0;if(null===d)f._renderComboItems(t),i=u*t.length;else{for(var r in d)o+=1,e("<div/>",{class:"ms-res-group",html:r}).appendTo(n.combobox),f._renderComboItems(d[r].items,!0);var a=n.combobox.find(".ms-res-group").outerHeight();if(null!==a){var l=o*a;i=u*t.length+l}else i=u*(t.length+o)}if(i<n.combobox.height()||i<=s.maxDropHeight?n.combobox.height(i):i>=n.combobox.height()&&i>s.maxDropHeight&&n.combobox.height(s.maxDropHeight),1===t.length&&!0===s.autoSelect&&n.combobox.children().filter(":not(.ms-res-item-disabled):last").addClass("ms-res-item-active"),!0===s.selectFirst&&n.combobox.children().filter(":not(.ms-res-item-disabled):first").addClass("ms-res-item-active"),0===t.length&&""!==n.getRawValue()){var c=s.noSuggestionText.replace(/\{\{.*\}\}/,n.input.val());f._updateHelper(c),n.collapse()}!1===s.allowFreeEntries&&(0===t.length?(e(n.input).addClass(s.invalidCls),n.combobox.hide()):e(n.input).removeClass(s.invalidCls))},_getEntriesFromStringArray:function(t){var i=[];return e.each(t,function(t,n){var o={};o[s.displayField]=o[s.valueField]=e.trim(n),i.push(o)}),i},_highlightSuggestion:function(t){var i=n.input.val(),o=["^","$","*","+","?",".","(",")",":","!","|","{","}","[","]"];if(e.each(o,function(e,t){i=i.replace(t,"\\"+t)}),0===i.length)return t;var r=!0===s.matchCase?"g":"gi";return t.replace(new RegExp("("+i+")(?!([^<]+)?>)",r),"<em>$1</em>")},_moveSelectedRow:function(e){s.expanded||n.expand();var t,i,o,r;t=n.combobox.find(".ms-res-item:not(.ms-res-item-disabled)"),i="down"===e?t.eq(0):t.filter(":last"),(o=n.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0&&("down"===e?(0===(i=o.nextAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(i=t.eq(0)),r=n.combobox.scrollTop(),n.combobox.scrollTop(0),i[0].offsetTop+i.outerHeight()>n.combobox.height()&&n.combobox.scrollTop(r+u)):(0===(i=o.prevAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(i=t.filter(":last"),n.combobox.scrollTop(u*t.length)),i[0].offsetTop<n.combobox.scrollTop()&&n.combobox.scrollTop(n.combobox.scrollTop()-u))),t.removeClass("ms-res-item-active"),i.addClass("ms-res-item-active")},_processSuggestions:function(t){var i=null,o=t||s.data;if(null!==o){if("function"==typeof o&&(o=o.call(n,n.getRawValue())),"string"==typeof o){e(n).trigger("beforeload",[n]);var r={};r[s.queryParam]=n.input.val();var a=e.extend(r,s.dataUrlParams);return void e.ajax(e.extend({type:s.method,url:o,data:a,beforeSend:s.beforeSend,success:function(t){i="string"==typeof t?JSON.parse(t):t,f._processSuggestions(i),e(n).trigger("load",[n,i]),f._asyncValues&&(n.setValue("string"==typeof f._asyncValues?JSON.parse(f._asyncValues):f._asyncValues),f._renderSelection(),delete f._asyncValues)},error:function(){throw"Could not reach server"}},s.ajaxConfig))}h=o.length>0&&"string"==typeof o[0]?f._getEntriesFromStringArray(o):o[s.resultsField]||o;var l="remote"===s.mode?h:f._sortAndTrim(h);f._displaySuggestions(f._group(l))}},_render:function(t){if(n.setName(s.name),n.container=e("<div/>",{class:"ms-ctn form-control "+(s.resultAsString?"ms-as-string ":"")+s.cls+(e(t).hasClass("input-lg")?" input-lg":"")+(e(t).hasClass("input-sm")?" input-sm":"")+(!0===s.disabled?" ms-ctn-disabled":"")+(!0===s.editable?"":" ms-ctn-readonly")+(!1===s.hideTrigger?"":" ms-no-trigger"),style:s.style,id:s.id}),n.container.focus(e.proxy(g._onFocus,this)),n.container.blur(e.proxy(g._onBlur,this)),n.container.keydown(e.proxy(g._onKeyDown,this)),n.container.keyup(e.proxy(g._onKeyUp,this)),n.input=e("<input/>",e.extend({type:"text",class:!0===s.editable?"":" ms-input-readonly",readonly:!s.editable,placeholder:s.placeholder,disabled:s.disabled},s.inputCfg)),n.input.focus(e.proxy(g._onInputFocus,this)),n.input.click(e.proxy(g._onInputClick,this)),n.combobox=e("<div/>",{class:"ms-res-ctn dropdown-menu"}).height(s.maxDropHeight),n.combobox.on("click","div.ms-res-item",e.proxy(g._onComboItemSelected,this)),n.combobox.on("mouseover","div.ms-res-item",e.proxy(g._onComboItemMouseOver,this)),s.selectionContainer?(n.selectionContainer=s.selectionContainer,e(n.selectionContainer).addClass("ms-sel-ctn")):n.selectionContainer=e("<div/>",{class:"ms-sel-ctn"}),n.selectionContainer.click(e.proxy(g._onFocus,this)),"inner"!==s.selectionPosition||s.selectionContainer?n.container.append(n.input):n.selectionContainer.append(n.input),n.helper=e("<span/>",{class:"ms-helper "+s.infoMsgCls}),f._updateHelper(),n.container.append(n.helper),e(t).replaceWith(n.container),!s.selectionContainer)switch(s.selectionPosition){case"bottom":n.selectionContainer.insertAfter(n.container),!0===s.selectionStacked&&(n.selectionContainer.width(n.container.width()),n.selectionContainer.addClass("ms-stacked"));break;case"right":n.selectionContainer.insertAfter(n.container),n.container.css("float","left");break;default:n.container.append(n.selectionContainer)}!1===s.hideTrigger&&(n.trigger=e("<div/>",{class:"ms-trigger",html:'<div class="ms-trigger-ico"></div>'}),n.trigger.click(e.proxy(g._onTriggerClick,this)),n.container.append(n.trigger)),e(window).resize(e.proxy(g._onWindowResized,this)),null===s.value&&null===s.data||("string"==typeof s.data?(f._asyncValues=s.value,f._processSuggestions()):(f._processSuggestions(),null!==s.value&&(n.setValue(s.value),f._renderSelection()))),e("body").click(function(e){n.container.hasClass("ms-ctn-focus")&&0===n.container.has(e.target).length&&e.target.className.indexOf("ms-res-item")<0&&e.target.className.indexOf("ms-close-btn")<0&&n.container[0]!==e.target&&g._onBlur()}),!0===s.expanded&&(s.expanded=!1,n.expand())},_renderComboItems:function(t,i){var o=this,r="";e.each(t,function(t,n){var a=null!==s.renderer?s.renderer.call(o,n):n[s.displayField],l=null!==s.disabledField&&!0===n[s.disabledField],u=e("<div/>",{class:"ms-res-item "+(i?"ms-res-item-grouped ":"")+(l?"ms-res-item-disabled ":"")+(t%2==1&&!0===s.useZebraStyle?"ms-res-odd":""),html:!0===s.highlight?f._highlightSuggestion(a):a,"data-json":JSON.stringify(n)});r+=e("<div/>").append(u).html()}),n.combobox.append(r),u=n.combobox.find(".ms-res-item:first").outerHeight()},_renderSelection:function(){var t=this,i=0,o=0,r=[],a=!0===s.resultAsString&&!c;n.selectionContainer.find(".ms-sel-item").remove(),void 0!==n._valueContainer&&n._valueContainer.remove(),e.each(l,function(i,n){var o,u=null!==s.selectionRenderer?s.selectionRenderer.call(t,n):n[s.displayField],c=f._validateSingleItem(n[s.displayField])?"":" ms-sel-invalid";!0===a?o=e("<div/>",{class:"ms-sel-item ms-sel-text "+s.selectionCls+c,html:u+(i===l.length-1?"":s.resultAsStringDelimiter)}).data("json",n):(o=e("<div/>",{class:"ms-sel-item "+s.selectionCls+c,html:u}).data("json",n),!1===s.disabled&&e("<span/>",{class:"ms-close-btn"}).data("json",n).appendTo(o).click(e.proxy(g._onTagTriggerClick,t))),r.push(o)}),n.selectionContainer.prepend(r),n._valueContainer=e("<div/>",{style:"display: none;"}),e.each(n.getValue(),function(t,i){e("<input/>",{type:"hidden",name:s.name,value:i}).appendTo(n._valueContainer)}),n._valueContainer.appendTo(n.selectionContainer),"inner"!==s.selectionPosition||s.selectionContainer||(n.input.width(0),o=n.input.offset().left-n.selectionContainer.offset().left,i=n.container.width()-o-42,n.input.width(i)),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):n.helper.hide()},_selectItem:function(e){1===s.maxSelection&&(l=[]),n.addToSelection(e.data("json")),e.removeClass("ms-res-item-active"),!1!==s.expandOnFocus&&l.length!==s.maxSelection||n.collapse(),c?c&&(s.expandOnFocus||p)&&(f._processSuggestions(),p&&n.expand()):n.input.focus()},_sortAndTrim:function(t){var i=n.getRawValue(),o=[],r=[],a=n.getValue();return i.length>0?e.each(t,function(e,t){var n=t[s.displayField];(!0===s.matchCase&&n.indexOf(i)>-1||!1===s.matchCase&&n.toLowerCase().indexOf(i.toLowerCase())>-1)&&(!1!==s.strictSuggest&&0!==n.toLowerCase().indexOf(i.toLowerCase())||o.push(t))}):o=t,e.each(o,function(t,i){(s.allowDuplicates||-1===e.inArray(i[s.valueField],a))&&r.push(i)}),null!==s.sortOrder&&r.sort(function(e,t){return e[s.sortOrder]<t[s.sortOrder]?"asc"===s.sortDir?-1:1:e[s.sortOrder]>t[s.sortOrder]?"asc"===s.sortDir?1:-1:0}),s.maxSuggestions&&s.maxSuggestions>0&&(r=r.slice(0,s.maxSuggestions)),r},_group:function(t){return null!==s.groupBy&&(d={},e.each(t,function(e,t){var i=s.groupBy.indexOf(".")>-1?s.groupBy.split("."):s.groupBy,n=t[s.groupBy];if("string"!=typeof i)for(n=t;i.length>0;)n=n[i.shift()];void 0===d[n]?d[n]={title:n,items:[t]}:d[n].items.push(t)})),t},_updateHelper:function(e){n.helper.html(e),n.helper.is(":visible")||n.helper.fadeIn()},_validateSingleItem:function(e){if(null!==s.vregex&&s.vregex instanceof RegExp)return s.vregex.test(e);if(null!==s.vtype)switch(s.vtype){case"alpha":return/^[a-zA-Z_]+$/.test(e);case"alphanum":return/^[a-zA-Z0-9_]+$/.test(e);case"email":return/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/.test(e);case"url":return/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i.test(e);case"ipaddress":return/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)}return!0}},g={_onBlur:function(){if(n.container.removeClass("ms-ctn-focus"),n.collapse(),c=!1,""!==n.getRawValue()&&!0===s.allowFreeEntries){var t={};t[s.displayField]=t[s.valueField]=n.getRawValue().trim(),n.addToSelection(t)}f._renderSelection(),!1===n.isValid()?n.container.addClass(s.invalidCls):""!==n.input.val()&&!1===s.allowFreeEntries&&(n.empty(),f._updateHelper("")),e(n).trigger("blur",[n])},_onComboItemMouseOver:function(t){var i=e(t.currentTarget);i.hasClass("ms-res-item-disabled")||(n.combobox.children().removeClass("ms-res-item-active"),i.addClass("ms-res-item-active"))},_onComboItemSelected:function(t){e(t.currentTarget).hasClass("ms-res-item-disabled")||f._selectItem(e(t.currentTarget))},_onFocus:function(){n.input.focus()},_onInputClick:function(){!1===n.isDisabled()&&c&&!0===s.toggleOnClick&&(s.expanded?n.collapse():n.expand())},_onInputFocus:function(){if(!1===n.isDisabled()&&!c){c=!0,n.container.addClass("ms-ctn-focus"),n.container.removeClass(s.invalidCls);var t=n.getRawValue().length;!0===s.expandOnFocus&&n.expand(),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):t<s.minChars&&f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t)),f._renderSelection(),e(n).trigger("focus",[n])}},_onKeyDown:function(t){var i=n.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first"),o=n.input.val();if(e(n).trigger("keydown",[n,t]),t.keyCode!==m.TAB||!1!==s.useTabKey&&(!0!==s.useTabKey||0!==i.length||0!==n.input.val().length))switch(t.keyCode){case m.BACKSPACE:0===o.length&&n.getSelection().length>0&&"inner"===s.selectionPosition&&(l.pop(),f._renderSelection(),e(n).trigger("selectionchange",[n,n.getSelection()]),n.input.attr("placeholder","inner"===s.selectionPosition&&n.getValue().length>0?"":s.placeholder),n.input.focus(),t.preventDefault());break;case m.TAB:case m.ESC:t.preventDefault();break;case m.ENTER:(""!==o||s.expanded)&&t.preventDefault();break;case m.COMMA:!0===s.useCommaKey&&t.preventDefault();break;case m.CTRL:p=!0;break;case m.DOWNARROW:t.preventDefault(),f._moveSelectedRow("down");break;case m.UPARROW:t.preventDefault(),f._moveSelectedRow("up");break;default:l.length===s.maxSelection&&t.preventDefault()}else g._onBlur()},_onKeyUp:function(t){var i,o=n.getRawValue(),r=e.trim(n.input.val()).length>0&&(!s.maxEntryLength||e.trim(n.input.val()).length<=s.maxEntryLength),u={};if(e(n).trigger("keyup",[n,t]),clearTimeout(a),t.keyCode===m.ESC&&s.expanded&&n.combobox.hide(),t.keyCode===m.TAB&&!1===s.useTabKey||t.keyCode>m.ENTER&&t.keyCode<m.SPACE)t.keyCode===m.CTRL&&(p=!1);else switch(t.keyCode){case m.UPARROW:case m.DOWNARROW:t.preventDefault();break;case m.ENTER:case m.TAB:case m.COMMA:if(t.keyCode!==m.COMMA||!0===s.useCommaKey){if(t.preventDefault(),!0===s.expanded&&(i=n.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0)return void f._selectItem(i);!0===r&&!0===s.allowFreeEntries&&(u[s.displayField]=u[s.valueField]=o.trim(),n.addToSelection(u),n.collapse(),n.input.focus());break}default:l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):o.length<s.minChars?(f._updateHelper(s.minCharsRenderer.call(this,s.minChars-o.length)),!0===s.expanded&&n.collapse()):s.maxEntryLength&&o.length>s.maxEntryLength?(f._updateHelper(s.maxEntryRenderer.call(this,o.length-s.maxEntryLength)),!0===s.expanded&&n.collapse()):(n.helper.hide(),s.minChars<=o.length&&(a=setTimeout(function(){!0===s.expanded?f._processSuggestions():n.expand()},s.typeDelay)))}},_onTagTriggerClick:function(t){n.removeFromSelection(e(t.currentTarget).data("json"))},_onTriggerClick:function(){if(!1===n.isDisabled()&&(!0!==s.expandOnFocus||l.length!==s.maxSelection))if(e(n).trigger("triggerclick",[n]),!0===s.expanded)n.collapse();else{var t=n.getRawValue().length;t>=s.minChars?(n.input.focus(),n.expand()):f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t))}},_onWindowResized:function(){f._renderSelection()}};null!==t&&f._render(t)};e.fn.magicSuggest=function(i){var n=e(this);return 1===n.size()&&n.data("magicSuggest")?n.data("magicSuggest"):(n.each(function(n){var o=e(this);if(!o.data("magicSuggest")){"select"===this.nodeName.toLowerCase()&&(i.data=[],i.value=[],e.each(this.children,function(t,n){n.nodeName&&"option"===n.nodeName.toLowerCase()&&(i.data.push({id:n.value,name:n.text}),e(n).attr("selected")&&i.value.push(n.value))}));var r={};e.each(this.attributes,function(e,t){r[t.name]="value"===t.name&&""!==t.value?JSON.parse(t.value):t.value});var s=new t(this,e.extend([],e.fn.magicSuggest.defaults,i,r));o.data("magicSuggest",s),s.container.data("magicSuggest",s)}}),1===n.size()?n.data("magicSuggest"):n)},e.fn.magicSuggest.defaults={}}(jQuery);