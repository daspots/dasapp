(function(){window.api_call=function(n,e,t,r,i){var o,u;i=i||r||t,r=r||t,4===arguments.length&&(r=void 0),3===arguments.length&&(t=void 0,r=void 0),t=t||{};for(o in t)null==t[o]&&delete t[o];return u=e.search("\\?")>=0?"&":"?",$.ajax({type:n,url:""+e+u+$.param(t),contentType:"application/json",accepts:"application/json",dataType:"json",data:r?JSON.stringify(r):void 0,success:function(e){var t;return"success"===e.status?(t=void 0,e.next_url&&(t=function(t){return api_call(n,e.next_url,{},t)}),"function"==typeof i?i(void 0,e.result,t):void 0):"function"==typeof i?i(e):void 0},error:function(n,e,t){var r;r={error_code:"ajax_error",text_status:e,error_thrown:t,jqXHR:n};try{n.responseText&&(r=$.parseJSON(n.responseText))}catch(n){n,r=r}return LOG("api_call error",r),"function"==typeof i?i(r):void 0}})}}).call(this),function(){window.LOG=function(){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,arguments):void 0},window.init_common=function(){return init_loading_button(),init_confirm_button(),init_password_show_button(),init_time(),init_announcement(),init_row_link()},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.init_confirm_button=function(){return $("body").on("click",".btn-confirm",function(){if(!confirm($(this).data("message")||"Are you sure?"))return event.preventDefault()})},window.init_password_show_button=function(){return $("body").on("click",".btn-password-show",function(){var n;return(n=$($(this).data("target"))).focus(),$(this).hasClass("active")?n.attr("type","password"):n.attr("type","text")})},window.init_time=function(){if($("time").length>0)return function(){return $("time[datetime]").each(function(){var n;return n=moment.utc($(this).attr("datetime")),moment().diff(n,"days")>25?$(this).text(n.local().format("YYYY-MM-DD")):$(this).text(n.fromNow()),$(this).attr("title",n.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(arguments.callee,45e3)}()},window.init_announcement=function(){if($(".alert-announcement button.close").click(function(){return"undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.setItem("closedAnnouncement",$(".alert-announcement").html()):void 0}),("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("closedAnnouncement"):void 0)!==$(".alert-announcement").html())return $(".alert-announcement").show()},window.init_row_link=function(){return $("body").on("click",".row-link",function(){return window.location.href=$(this).data("href")}),$("body").on("click",".not-link",function(n){return n.stopPropagation()})},window.clear_notifications=function(){return $("#notifications").empty()},window.show_notification=function(n,e){if(null==e&&(e="warning"),clear_notifications(),n)return $("#notifications").append('<div class="alert alert-dismissable alert-'+e+'">\n  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n  '+n+"\n</div>")}}.call(this),function(){$(function(){return init_common()}),$(function(){return $("html.auth").each(function(){return init_auth()})}),$(function(){return $("html.user-list").each(function(){return init_user_list()})}),$(function(){return $("html.user-merge").each(function(){return init_user_merge()})})}.call(this),function(){window.init_auth=function(){return $(".remember").change(function(){var n,e,t,r,i,o;for(o=[],r=0,i=(e=$(".btn-social").toArray().concat($(".btn-social-icon").toArray())).length;r<i;r++)n=e[r],t=$(n).prop("href"),$(".remember input").is(":checked")?($(n).prop("href",t+"&remember=true"),o.push($("#remember").prop("checked",!0))):($(n).prop("href",t.replace("&remember=true","")),o.push($("#remember").prop("checked",!1)));return o}),$(".remember").change()}}.call(this),function(){var n,e,t,r,i,o;window.init_user_list=function(){return t(),n(),e()},t=function(){return $("input[name=user_db]").each(function(){return o($(this))}),$("#select-all").change(function(){return $("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){return o($(this))})}),$("input[name=user_db]").change(function(){return o($(this))})},o=function(n){return i(),$("input[name=user_db]").each(function(){var e;return e=n.val(),$("#"+e).toggleClass("warning",n.is(":checked"))})},i=function(){var n;return n=$("input[name=user_db]:checked").length,$("#user-actions").toggleClass("hidden",0===n),$("#user-merge").toggleClass("hidden",n<2),0===n?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},n=function(){return $("#user-delete").click(function(n){var e,t,r,o,u;if(clear_notifications(),n.preventDefault(),e=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length),confirm(e))return u=[],$("input[name=user_db]:checked").each(function(){return $(this).attr("disabled",!0),u.push($(this).val())}),t=$(this).data("api-url"),o=$(this).data("success"),r=$(this).data("error"),api_call("DELETE",t,{user_keys:u.join(",")},function(n,e){return n?($("input[name=user_db]:disabled").removeAttr("disabled"),void show_notification(r.replace("{users}",u.length),"danger")):$("#"+e.join(", #")).fadeOut(function(){return $(this).remove(),i(),show_notification(o.replace("{users}",u.length),"success")})})})},window.init_user_merge=function(){var n,e;return e=$("#user_keys").val(),n=$(".api-url").data("api-url"),api_call("GET",n,{user_keys:e},function(n,e){if(!n)return window.user_dbs=e,$("input[name=user_db]").removeAttr("disabled");LOG("Something went terribly wrong")}),$("input[name=user_db]").change(function(n){var e;return e=$(n.currentTarget).val(),r(e)})},r=function(n){var e,t,r,i;for($(".user-row").removeClass("success").addClass("danger"),$("#"+n).removeClass("danger").addClass("success"),r=[],e=0,t=user_dbs.length;e<t;e++){if(i=user_dbs[e],n===i.key){$("input[name=user_key]").val(i.key),$("input[name=username]").val(i.username),$("input[name=name]").val(i.name),$("input[name=email]").val(i.email);break}r.push(void 0)}return r},e=function(){return $("#user-merge").click(function(n){var e,t;return n.preventDefault(),e=[],$("input[name=user_db]:checked").each(function(){return e.push($(this).val())}),t=$(this).data("user-merge-url"),window.location.href=t+"?user_keys="+e.join(",")})}}.call(this);