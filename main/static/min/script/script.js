function followFunction(e,t){api_url="/api/v1/follow/"+t+"/",e.classList.contains("label-default")?e.classList.contains("not-logged-in")?($(".recommender").css({display:"none"}),$("#loginform").fadeIn()):(e.classList.remove("label-default"),e.classList.add("label-success"),e.innerHTML="FOLLOWING",$.ajax({url:api_url,type:"PUT",data:{},success:function(){}})):e.classList.contains("label-success")&&(e.classList.remove("label-success"),e.classList.add("label-default"),e.innerHTML="FOLLOW",$.ajax({url:api_url,type:"DELETE",success:function(e){}}))}function starFunction(e,t){api_url="/api/v1/star/"+t+"/",e.classList.contains("fa-star-o")?e.classList.contains("not-logged-in")?($("#restaurant").css({display:"none"}),$("#loginform").fadeIn()):(e.classList.remove("fa-star-o"),e.classList.add("fa-star"),$.ajax({url:api_url,type:"PUT",data:{},success:function(){}})):e.classList.contains("fa-star")&&(e.classList.remove("fa-star"),e.classList.add("fa-star-o"),$.ajax({url:api_url,type:"DELETE",success:function(e){}}))}(function(){window.api_call=function(e,t,n,i,o){var r,s;o=o||i||n,i=i||n,4===arguments.length&&(i=void 0),3===arguments.length&&(n=void 0,i=void 0),n=n||{};for(r in n)null==n[r]&&delete n[r];return s=t.search("\\?")>=0?"&":"?",$.ajax({type:e,url:""+t+s+$.param(n),contentType:"application/json",accepts:"application/json",dataType:"json",data:i?JSON.stringify(i):void 0,success:function(t){var n;return"success"===t.status?(n=void 0,t.next_url&&(n=function(n){return api_call(e,t.next_url,{},n)}),"function"==typeof o?o(void 0,t.result,n):void 0):"function"==typeof o?o(t):void 0},error:function(e,t,n){var i;i={error_code:"ajax_error",text_status:t,error_thrown:n,jqXHR:e};try{e.responseText&&(i=$.parseJSON(e.responseText))}catch(e){e,i=i}return LOG("api_call error",i),"function"==typeof o?o(i):void 0}})}}).call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};window.FileUploader=function(){function n(t){var n,i;this.options=t,this.upload_file=e(this.upload_file,this),this.process_files=e(this.process_files,this),this.get_upload_urls=e(this.get_upload_urls,this),this.upload_files=e(this.upload_files,this),this.file_select_handler=e(this.file_select_handler,this),this.file_drag_hover=e(this.file_drag_hover,this),this.upload_handler=this.options.upload_handler,this.selector=this.options.selector,this.drop_area=this.options.drop_area,this.upload_url=this.options.upload_url||"/api/v1"+window.location.pathname,this.confirm_message=this.options.confirm_message||"Files are still being uploaded.",this.allowed_types=this.options.allowed_types,this.max_size=this.options.max_size,this.active_files=0,null!=(n=this.selector)&&n.bind("change",function(e){return function(t){return e.file_select_handler(t)}}(this)),i=new XMLHttpRequest,null!=this.drop_area&&i.upload&&(this.drop_area.on("dragover",this.file_drag_hover),this.drop_area.on("dragleave",this.file_drag_hover),this.drop_area.on("drop",function(e){return function(t){return e.file_select_handler(t)}}(this)),this.drop_area.show()),window.onbeforeunload=function(e){return function(){if(null!=e.confirm_message&&e.active_files>0)return e.confirm_message}}(this)}return n.prototype.file_drag_hover=function(e){if(null!=this.drop_area)return e.stopPropagation(),e.preventDefault(),"dragover"===e.type?this.drop_area.addClass("drag-hover"):this.drop_area.removeClass("drag-hover")},n.prototype.file_select_handler=function(e){var t,n,i,o;if(this.file_drag_hover(e),(null!=(t=(null!=(n=e.originalEvent.dataTransfer)?n.files:void 0)||(null!=(i=e.target)?i.files:void 0)||(null!=(o=e.dataTransfer)?o.files:void 0))?t.length:void 0)>0)return this.upload_files(t)},n.prototype.upload_files=function(e){return this.get_upload_urls(e.length,function(t){return function(n,i){if(!n)return t.process_files(e,i,0);console.log("Error getting URLs",n)}}(this))},n.prototype.get_upload_urls=function(e,t){if(!(e<=0))return api_call("GET",this.upload_url,{count:e},function(e,n){if(e)throw t(e),e;return t(void 0,n)})},n.prototype.process_files=function(e,t,n){var i;if(!(n>=e.length))return this.upload_file(e[n],t[n].upload_url,null!=(i=this.upload_handler)?i.preview(e[n]):void 0,function(i){return function(){return i.process_files(e,t,n+1,null!=i.upload_handler)}}(this))},n.prototype.upload_file=function(e,n,i,o){var r,s,a,l;return l=new XMLHttpRequest,(null!=(s=this.allowed_types)?s.length:void 0)>0&&(a=e.type,t.call(this.allowed_types,a)<0)?(i(0,void 0,"wrong_type"),void o()):null!=this.max_size&&e.size>this.max_size?(i(0,void 0,"too_big"),void o()):(l.upload.addEventListener("progress",function(e){return i(parseInt(e.loaded/e.total*100))}),l.onreadystatechange=function(e){return function(t){var n;if(4===l.readyState)return 200===l.status?(n=JSON.parse(l.responseText),i(100,n.result),$("#image").val($("#image").val()+n.result.id+";"),e.active_files-=1):(i(0,void 0,"error"),e.active_files-=1)}}(this),l.open("POST",n,!0),(r=new FormData).append("file",e),l.send(r),o())},n}()}.call(this),function(){window.LOG=function(){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,arguments):void 0},window.init_common=function(){return init_loading_button(),init_confirm_button(),init_password_show_button(),init_time(),init_announcement(),init_row_link()},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.init_confirm_button=function(){return $("body").on("click",".btn-confirm",function(){if(!confirm($(this).data("message")||"Are you sure?"))return event.preventDefault()})},window.init_password_show_button=function(){return $("body").on("click",".btn-password-show",function(){var e;return(e=$($(this).data("target"))).focus(),$(this).hasClass("active")?e.attr("type","password"):e.attr("type","text")})},window.init_time=function(){if($("time").length>0)return function(){return $("time[datetime]").each(function(){var e;return e=moment.utc($(this).attr("datetime")),moment().diff(e,"days")>25?$(this).text(e.local().format("YYYY-MM-DD")):$(this).text(e.fromNow()),$(this).attr("title",e.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(arguments.callee,45e3)}()},window.init_announcement=function(){if($(".alert-announcement button.close").click(function(){return"undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.setItem("closedAnnouncement",$(".alert-announcement").html()):void 0}),("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("closedAnnouncement"):void 0)!==$(".alert-announcement").html())return $(".alert-announcement").show()},window.init_row_link=function(){return $("body").on("click",".row-link",function(){return window.location.href=$(this).data("href")}),$("body").on("click",".not-link",function(e){return e.stopPropagation()})},window.clear_notifications=function(){return $("#notifications").empty()},window.show_notification=function(e,t){if(null==t&&(t="warning"),clear_notifications(),e)return $("#notifications").append('<div class="alert alert-dismissable alert-'+t+'">\n  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n  '+e+"\n</div>")},window.size_human=function(e){var t,n,i,o;for(t=0,n=(i=["B","KB","MB","GB","TB"]).length;t<n;t++){if(o=i[t],e<1e3)return"B"===o?e+" "+o:parseInt(10*e)/10+" "+o;e/=1024}}}.call(this),function(){$(function(){return init_common()}),$(function(){return $("html.auth").each(function(){return init_auth()})}),$(function(){return $("html.user-list").each(function(){return init_user_list()})}),$(function(){return $("html.user-merge").each(function(){return init_user_merge()})}),$(function(){return $("html.resource-list").each(function(){return init_resource_list()})}),$(function(){return $("html.resource-view").each(function(){return init_resource_view()})}),$(function(){return $("html.post-create").each(function(){return init_resource_upload()})}),$(function(){return $("html.recommender-create").each(function(){return init_resource_upload()})})}.call(this),function(){window.init_auth=function(){return $(".remember").change(function(){var e,t,n,i,o,r;for(r=[],i=0,o=(t=$(".btn-social").toArray().concat($(".btn-social-icon").toArray())).length;i<o;i++)e=t[i],n=$(e).prop("href"),$(".remember input").is(":checked")?($(e).prop("href",n+"&remember=true"),r.push($("#remember").prop("checked",!0))):($(e).prop("href",n.replace("&remember=true","")),r.push($("#remember").prop("checked",!1)));return r}),$(".remember").change()}}.call(this),function(){$(".pretty-file").length&&$(".pretty-file").each(function(){var e,t;return t=$(this),(e=t.find('input[type="file"]')).hide(),e.change(function(){var n,i,o;return n=e[0].files,i="",i=n.length>1?n.length+" files selected":(o=e.val().split("\\"))[o.length-1],t.find(".input-group input").val(i)}),t.find(".input-group").click(function(t){return t.preventDefault(),e.click(),$(this).blur()})})}.call(this),function(){var e;window.init_resource_list=function(){return init_delete_resource_button()},window.init_resource_view=function(){return init_delete_resource_button()},window.init_resource_upload=function(){if(window.File&&window.FileList&&window.FileReader)return window.file_uploader=new FileUploader({upload_handler:e,selector:$(".file"),drop_area:$(".drop-area"),confirm_message:"Files are still being uploaded.",upload_url:$(".file").data("get-upload-url"),allowed_types:[],max_size:1073741824})},e={preview:function(e){var t,n,i;return n=$('<div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">\n  <div class="thumbnail">\n    <div class="preview"></div>\n    <h5>'+e.name+'</h5>\n    <div class="progress">\n      <div class="progress-bar" style="width: 0%;"></div>\n      <div class="progress-text"></div>\n    </div>\n  </div>\n</div>'),t=$(".preview",n),file_uploader.active_files<16&&0===e.type.indexOf("image")?((i=new FileReader).onload=function(e){return t.css("background-image","url("+e.target.result+")")},i.readAsDataURL(e)):t.text(e.type||"application/octet-stream"),$(".resource-uploads").prepend(n),function(i,o,r){return r?($(".progress-bar",n).css("width","100%"),$(".progress-bar",n).addClass("progress-bar-danger"),void("too_big"===r?$(".progress-text",n).text("Failed! Too big, max: "+size_human(file_uploader.max_size)+"."):"wrong_type"===r?$(".progress-text",n).text("Failed! Wrong file type."):$(".progress-text",n).text("Failed!"))):100===i&&o?($(".progress-bar",n).addClass("progress-bar-success"),$(".progress-text",n).text("Success "+size_human(e.size)),o.image_url&&t.text().length>0?(t.css("background-image","url("+o.image_url+")"),t.text("")):void 0):100===i?($(".progress-bar",n).css("width","100%"),$(".progress-text",n).text("100% - Processing..")):($(".progress-bar",n).css("width",i+"%"),$(".progress-text",n).text(i+"% of "+size_human(e.size)))}}},window.init_delete_resource_button=function(){return $("body").on("click",".btn-delete",function(e){if(e.preventDefault(),confirm("Press OK to delete the resource"))return $(this).attr("disabled","disabled"),api_call("DELETE",$(this).data("api-url"),function(e){return function(t,n){var i,o;return t?($(e).removeAttr("disabled"),void LOG("Something went terribly wrong during delete!",t)):(o=$(e).data("target"),i=$(e).data("redirect-url"),o&&$(""+o).remove(),i?window.location.href=i:void 0)}}(this))})}}.call(this),function(){var e,t,n,i,o,r;window.init_user_list=function(){return n(),e(),t()},n=function(){return $("input[name=user_db]").each(function(){return r($(this))}),$("#select-all").change(function(){return $("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){return r($(this))})}),$("input[name=user_db]").change(function(){return r($(this))})},r=function(e){return o(),$("input[name=user_db]").each(function(){var t;return t=e.val(),$("#"+t).toggleClass("warning",e.is(":checked"))})},o=function(){var e;return e=$("input[name=user_db]:checked").length,$("#user-actions").toggleClass("hidden",0===e),$("#user-merge").toggleClass("hidden",e<2),0===e?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},e=function(){return $("#user-delete").click(function(e){var t,n,i,r,s;if(clear_notifications(),e.preventDefault(),t=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length),confirm(t))return s=[],$("input[name=user_db]:checked").each(function(){return $(this).attr("disabled",!0),s.push($(this).val())}),n=$(this).data("api-url"),r=$(this).data("success"),i=$(this).data("error"),api_call("DELETE",n,{user_keys:s.join(",")},function(e,t){return e?($("input[name=user_db]:disabled").removeAttr("disabled"),void show_notification(i.replace("{users}",s.length),"danger")):$("#"+t.join(", #")).fadeOut(function(){return $(this).remove(),o(),show_notification(r.replace("{users}",s.length),"success")})})})},window.init_user_merge=function(){var e,t;return t=$("#user_keys").val(),e=$(".api-url").data("api-url"),api_call("GET",e,{user_keys:t},function(e,t){if(!e)return window.user_dbs=t,$("input[name=user_db]").removeAttr("disabled");LOG("Something went terribly wrong")}),$("input[name=user_db]").change(function(e){var t;return t=$(e.currentTarget).val(),i(t)})},i=function(e){var t,n,i,o;for($(".user-row").removeClass("success").addClass("danger"),$("#"+e).removeClass("danger").addClass("success"),i=[],t=0,n=user_dbs.length;t<n;t++){if(o=user_dbs[t],e===o.key){$("input[name=user_key]").val(o.key),$("input[name=username]").val(o.username),$("input[name=name]").val(o.name),$("input[name=email]").val(o.email);break}i.push(void 0)}return i},t=function(){return $("#user-merge").click(function(e){var t,n;return e.preventDefault(),t=[],$("input[name=user_db]:checked").each(function(){return t.push($(this).val())}),n=$(this).data("user-merge-url"),window.location.href=n+"?user_keys="+t.join(",")})}}.call(this),$(".close-icon").on("click",function(){$(this).closest(".card").css({display:"none"}),$(".recommender").fadeIn()});var keywords=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:"/keywords",filter:function(e){return $.map(e,function(e){return{name:e}})}}});keywords.initialize(),$("#search").typeahead(null,{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}),$("#search_page").typeahead(null,{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}),$("#keywords").tagsinput({confirmKeys:[13,44],typeaheadjs:[{minLength:1,highlight:!0},{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}],freeInput:!0}),$("#location_keywords").tagsinput({confirmKeys:[13,44],typeaheadjs:[{minLength:1,highlight:!0},{minlength:1,name:"keywords",displayKey:"name",valueKey:"name",source:keywords.ttAdapter()}],freeInput:!0}),$(".draaiknopje").click(function(){setTimeout(function(){$(".grid").masonry("layout")},100)}),window.onload=function(){Gifffer({playButtonStyles:{width:"60px",height:"60px","border-radius":"30px",background:"rgba(0, 0, 0, 0.3)",position:"absolute",top:"50%",left:"50%",margin:"-30px 0 0 -30px"},playButtonIconStyles:{width:"0",height:"0","border-top":"14px solid transparent","border-bottom":"14px solid transparent","border-left":"14px solid rgba(255,255,255, 0.5)",position:"absolute",left:"26px",top:"16px"}}),$(".grid").masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0})},function(e,t){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(n){return t(e,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.jQueryBridget=t(e,e.jQuery)}(window,function(e,t){"use strict";function n(n,r,a){function l(e,t,i){var o,r="$()."+n+'("'+t+'")';return e.each(function(e,l){var u=a.data(l,n);if(u){var c=u[t];if(c&&"_"!=t.charAt(0)){var d=c.apply(u,i);o=void 0===o?d:o}else s(r+" is not a valid method")}else s(n+" not initialized. Cannot call methods, i.e. "+r)}),void 0!==o?o:e}function u(e,t){e.each(function(e,i){var o=a.data(i,n);o?(o.option(t),o._init()):(o=new r(i,t),a.data(i,n,o))})}(a=a||t||e.jQuery)&&(r.prototype.option||(r.prototype.option=function(e){a.isPlainObject(e)&&(this.options=a.extend(!0,this.options,e))}),a.fn[n]=function(e){return"string"==typeof e?l(this,e,o.call(arguments,1)):(u(this,e),this)},i(a))}function i(e){!e||e&&e.bridget||(e.bridget=n)}var o=Array.prototype.slice,r=e.console,s=void 0===r?function(){}:function(e){r.error(e)};return i(t||e.jQuery),n}),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var n=this._events=this._events||{},i=n[e]=n[e]||[];return-1==i.indexOf(t)&&i.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var n=this._onceEvents=this._onceEvents||{};return(n[e]=n[e]||{})[t]=!0,this}},t.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=n.indexOf(t);return-1!=i&&n.splice(i,1),this}},t.emitEvent=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=0,o=n[i];t=t||[];for(var r=this._onceEvents&&this._onceEvents[e];o;){var s=r&&r[o];s&&(this.off(e,o),delete r[o]),o.apply(this,t),o=n[i+=s?0:1]}return this}},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return t()}):"object"==typeof module&&module.exports?module.exports=t():e.getSize=t()}(window,function(){"use strict";function e(e){var t=parseFloat(e);return-1==e.indexOf("%")&&!isNaN(t)&&t}function t(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;l>t;t++)e[a[t]]=0;return e}function n(e){var t=getComputedStyle(e);return t||s("Style returned "+t+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),t}function i(){if(!u){u=!0;var t=document.createElement("div");t.style.width="200px",t.style.padding="1px 2px 3px 4px",t.style.borderStyle="solid",t.style.borderWidth="1px 2px 3px 4px",t.style.boxSizing="border-box";var i=document.body||document.documentElement;i.appendChild(t);var s=n(t);o.isBoxSizeOuter=r=200==e(s.width),i.removeChild(t)}}function o(o){if(i(),"string"==typeof o&&(o=document.querySelector(o)),o&&"object"==typeof o&&o.nodeType){var s=n(o);if("none"==s.display)return t();var u={};u.width=o.offsetWidth,u.height=o.offsetHeight;for(var c=u.isBorderBox="border-box"==s.boxSizing,d=0;l>d;d++){var h=a[d],p=s[h],m=parseFloat(p);u[h]=isNaN(m)?0:m}var f=u.paddingLeft+u.paddingRight,g=u.paddingTop+u.paddingBottom,v=u.marginLeft+u.marginRight,y=u.marginTop+u.marginBottom,_=u.borderLeftWidth+u.borderRightWidth,b=u.borderTopWidth+u.borderBottomWidth,x=c&&r,C=e(s.width);!1!==C&&(u.width=C+(x?0:f+_));var w=e(s.height);return!1!==w&&(u.height=w+(x?0:g+b)),u.innerWidth=u.width-(f+_),u.innerHeight=u.height-(g+b),u.outerWidth=u.width+v,u.outerHeight=u.height+y,u}}var r,s="undefined"==typeof console?function(){}:function(e){console.error(e)},a=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],l=a.length,u=!1;return o}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",t):"object"==typeof module&&module.exports?module.exports=t():e.matchesSelector=t()}(window,function(){"use strict";var e=function(){var e=window.Element.prototype;if(e.matches)return"matches";if(e.matchesSelector)return"matchesSelector";for(var t=["webkit","moz","ms","o"],n=0;n<t.length;n++){var i=t[n]+"MatchesSelector";if(e[i])return i}}();return function(t,n){return t[e](n)}}),function(e,t){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(n){return t(e,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("desandro-matches-selector")):e.fizzyUIUtils=t(e,e.matchesSelector)}(window,function(e,t){var n={};n.extend=function(e,t){for(var n in t)e[n]=t[n];return e},n.modulo=function(e,t){return(e%t+t)%t},n.makeArray=function(e){var t=[];if(Array.isArray(e))t=e;else if(e&&"object"==typeof e&&"number"==typeof e.length)for(var n=0;n<e.length;n++)t.push(e[n]);else t.push(e);return t},n.removeFrom=function(e,t){var n=e.indexOf(t);-1!=n&&e.splice(n,1)},n.getParent=function(e,n){for(;e!=document.body;)if(e=e.parentNode,t(e,n))return e},n.getQueryElement=function(e){return"string"==typeof e?document.querySelector(e):e},n.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},n.filterFindElements=function(e,i){var o=[];return(e=n.makeArray(e)).forEach(function(e){if(e instanceof HTMLElement){if(!i)return void o.push(e);t(e,i)&&o.push(e);for(var n=e.querySelectorAll(i),r=0;r<n.length;r++)o.push(n[r])}}),o},n.debounceMethod=function(e,t,n){var i=e.prototype[t],o=t+"Timeout";e.prototype[t]=function(){var e=this[o];e&&clearTimeout(e);var t=arguments,r=this;this[o]=setTimeout(function(){i.apply(r,t),delete r[o]},n||100)}},n.docReady=function(e){var t=document.readyState;"complete"==t||"interactive"==t?setTimeout(e):document.addEventListener("DOMContentLoaded",e)},n.toDashed=function(e){return e.replace(/(.)([A-Z])/g,function(e,t,n){return t+"-"+n}).toLowerCase()};var i=e.console;return n.htmlInit=function(t,o){n.docReady(function(){var r=n.toDashed(o),s="data-"+r,a=document.querySelectorAll("["+s+"]"),l=document.querySelectorAll(".js-"+r),u=n.makeArray(a).concat(n.makeArray(l)),c=s+"-options",d=e.jQuery;u.forEach(function(e){var n,r=e.getAttribute(s)||e.getAttribute(c);try{n=r&&JSON.parse(r)}catch(t){return void(i&&i.error("Error parsing "+s+" on "+e.className+": "+t))}var a=new t(e,n);d&&d.data(e,o,a)})})},n}),function(e,t){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("ev-emitter"),require("get-size")):(e.Outlayer={},e.Outlayer.Item=t(e.EvEmitter,e.getSize))}(window,function(e,t){"use strict";function n(e){for(var t in e)return!1;return null,!0}function i(e,t){e&&(this.element=e,this.layout=t,this.position={x:0,y:0},this._create())}var o=document.documentElement.style,r="string"==typeof o.transition?"transition":"WebkitTransition",s="string"==typeof o.transform?"transform":"WebkitTransform",a={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],l={transform:s,transition:r,transitionDuration:r+"Duration",transitionProperty:r+"Property",transitionDelay:r+"Delay"},u=i.prototype=Object.create(e.prototype);u.constructor=i,u._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},u.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},u.getSize=function(){this.size=t(this.element)},u.css=function(e){var t=this.element.style;for(var n in e)t[l[n]||n]=e[n]},u.getPosition=function(){var e=getComputedStyle(this.element),t=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop"),i=e[t?"left":"right"],o=e[n?"top":"bottom"],r=this.layout.size,s=-1!=i.indexOf("%")?parseFloat(i)/100*r.width:parseInt(i,10),a=-1!=o.indexOf("%")?parseFloat(o)/100*r.height:parseInt(o,10);s=isNaN(s)?0:s,a=isNaN(a)?0:a,s-=t?r.paddingLeft:r.paddingRight,a-=n?r.paddingTop:r.paddingBottom,this.position.x=s,this.position.y=a},u.layoutPosition=function(){var e=this.layout.size,t={},n=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),o=n?"paddingLeft":"paddingRight",r=n?"left":"right",s=n?"right":"left",a=this.position.x+e[o];t[r]=this.getXValue(a),t[s]="";var l=i?"paddingTop":"paddingBottom",u=i?"top":"bottom",c=i?"bottom":"top",d=this.position.y+e[l];t[u]=this.getYValue(d),t[c]="",this.css(t),this.emitEvent("layout",[this])},u.getXValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!t?e/this.layout.size.width*100+"%":e+"px"},u.getYValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&t?e/this.layout.size.height*100+"%":e+"px"},u._transitionTo=function(e,t){this.getPosition();var n=this.position.x,i=this.position.y,o=parseInt(e,10),r=parseInt(t,10),s=o===this.position.x&&r===this.position.y;if(this.setPosition(e,t),!s||this.isTransitioning){var a=e-n,l=t-i,u={};u.transform=this.getTranslate(a,l),this.transition({to:u,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},u.getTranslate=function(e,t){var n=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop");return e=n?e:-e,t=i?t:-t,"translate3d("+e+"px, "+t+"px, 0)"},u.goTo=function(e,t){this.setPosition(e,t),this.layoutPosition()},u.moveTo=u._transitionTo,u.setPosition=function(e,t){this.position.x=parseInt(e,10),this.position.y=parseInt(t,10)},u._nonTransition=function(e){this.css(e.to),e.isCleaning&&this._removeStyles(e.to);for(var t in e.onTransitionEnd)e.onTransitionEnd[t].call(this)},u.transition=function(e){if(parseFloat(this.layout.options.transitionDuration)){var t=this._transn;for(var n in e.onTransitionEnd)t.onEnd[n]=e.onTransitionEnd[n];for(n in e.to)t.ingProperties[n]=!0,e.isCleaning&&(t.clean[n]=!0);if(e.from){this.css(e.from);this.element.offsetHeight;null}this.enableTransition(e.to),this.css(e.to),this.isTransitioning=!0}else this._nonTransition(e)};var c="opacity,"+function(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}(s);u.enableTransition=function(){if(!this.isTransitioning){var e=this.layout.options.transitionDuration;e="number"==typeof e?e+"ms":e,this.css({transitionProperty:c,transitionDuration:e,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(a,this,!1)}},u.onwebkitTransitionEnd=function(e){this.ontransitionend(e)},u.onotransitionend=function(e){this.ontransitionend(e)};var d={"-webkit-transform":"transform"};u.ontransitionend=function(e){if(e.target===this.element){var t=this._transn,i=d[e.propertyName]||e.propertyName;delete t.ingProperties[i],n(t.ingProperties)&&this.disableTransition(),i in t.clean&&(this.element.style[e.propertyName]="",delete t.clean[i]),i in t.onEnd&&(t.onEnd[i].call(this),delete t.onEnd[i]),this.emitEvent("transitionEnd",[this])}},u.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(a,this,!1),this.isTransitioning=!1},u._removeStyles=function(e){var t={};for(var n in e)t[n]="";this.css(t)};var h={transitionProperty:"",transitionDuration:"",transitionDelay:""};return u.removeTransitionStyles=function(){this.css(h)},u.stagger=function(e){e=isNaN(e)?0:e,this.staggerDelay=e+"ms"},u.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},u.remove=function(){return r&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},u.reveal=function(){delete this.isHidden,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:e.hiddenStyle,to:e.visibleStyle,isCleaning:!0,onTransitionEnd:t})},u.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},u.getHideRevealTransitionEndProperty=function(e){var t=this.layout.options[e];if(t.opacity)return"opacity";for(var n in t)return n},u.hide=function(){this.isHidden=!0,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:e.visibleStyle,to:e.hiddenStyle,isCleaning:!0,onTransitionEnd:t})},u.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},u.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},i}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(n,i,o,r){return t(e,n,i,o,r)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):e.Outlayer=t(e,e.EvEmitter,e.getSize,e.fizzyUIUtils,e.Outlayer.Item)}(window,function(e,t,n,i,o){"use strict";function r(e,t){var n=i.getQueryElement(e);if(n){this.element=n,u&&(this.$element=u(this.element)),this.options=i.extend({},this.constructor.defaults),this.option(t);var o=++d;this.element.outlayerGUID=o,h[o]=this,this._create(),this._getOption("initLayout")&&this.layout()}else l&&l.error("Bad element for "+this.constructor.namespace+": "+(n||e))}function s(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}function a(e){if("number"==typeof e)return e;var t=e.match(/(^\d*\.?\d*)(\w*)/),n=t&&t[1],i=t&&t[2];return n.length?(n=parseFloat(n))*(m[i]||1):0}var l=e.console,u=e.jQuery,c=function(){},d=0,h={};r.namespace="outlayer",r.Item=o,r.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var p=r.prototype;i.extend(p,t.prototype),p.option=function(e){i.extend(this.options,e)},p._getOption=function(e){var t=this.constructor.compatOptions[e];return t&&void 0!==this.options[t]?this.options[t]:this.options[e]},r.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},p._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),i.extend(this.element.style,this.options.containerStyle),this._getOption("resize")&&this.bindResize()},p.reloadItems=function(){this.items=this._itemize(this.element.children)},p._itemize=function(e){for(var t=this._filterFindItemElements(e),n=this.constructor.Item,i=[],o=0;o<t.length;o++){var r=new n(t[o],this);i.push(r)}return i},p._filterFindItemElements=function(e){return i.filterFindElements(e,this.options.itemSelector)},p.getItemElements=function(){return this.items.map(function(e){return e.element})},p.layout=function(){this._resetLayout(),this._manageStamps();var e=this._getOption("layoutInstant"),t=void 0!==e?e:!this._isLayoutInited;this.layoutItems(this.items,t),this._isLayoutInited=!0},p._init=p.layout,p._resetLayout=function(){this.getSize()},p.getSize=function(){this.size=n(this.element)},p._getMeasurement=function(e,t){var i,o=this.options[e];o?("string"==typeof o?i=this.element.querySelector(o):o instanceof HTMLElement&&(i=o),this[e]=i?n(i)[t]:o):this[e]=0},p.layoutItems=function(e,t){e=this._getItemsForLayout(e),this._layoutItems(e,t),this._postLayout()},p._getItemsForLayout=function(e){return e.filter(function(e){return!e.isIgnored})},p._layoutItems=function(e,t){if(this._emitCompleteOnItems("layout",e),e&&e.length){var n=[];e.forEach(function(e){var i=this._getItemLayoutPosition(e);i.item=e,i.isInstant=t||e.isLayoutInstant,n.push(i)},this),this._processLayoutQueue(n)}},p._getItemLayoutPosition=function(){return{x:0,y:0}},p._processLayoutQueue=function(e){this.updateStagger(),e.forEach(function(e,t){this._positionItem(e.item,e.x,e.y,e.isInstant,t)},this)},p.updateStagger=function(){var e=this.options.stagger;return null===e||void 0===e?void(this.stagger=0):(this.stagger=a(e),this.stagger)},p._positionItem=function(e,t,n,i,o){i?e.goTo(t,n):(e.stagger(o*this.stagger),e.moveTo(t,n))},p._postLayout=function(){this.resizeContainer()},p.resizeContainer=function(){if(this._getOption("resizeContainer")){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},p._getContainerSize=c,p._setContainerMeasure=function(e,t){if(void 0!==e){var n=this.size;n.isBorderBox&&(e+=t?n.paddingLeft+n.paddingRight+n.borderLeftWidth+n.borderRightWidth:n.paddingBottom+n.paddingTop+n.borderTopWidth+n.borderBottomWidth),e=Math.max(e,0),this.element.style[t?"width":"height"]=e+"px"}},p._emitCompleteOnItems=function(e,t){function n(){o.dispatchEvent(e+"Complete",null,[t])}function i(){++s==r&&n()}var o=this,r=t.length;if(t&&r){var s=0;t.forEach(function(t){t.once(e,i)})}else n()},p.dispatchEvent=function(e,t,n){var i=t?[t].concat(n):n;if(this.emitEvent(e,i),u)if(this.$element=this.$element||u(this.element),t){var o=u.Event(t);o.type=e,this.$element.trigger(o,n)}else this.$element.trigger(e,n)},p.ignore=function(e){var t=this.getItem(e);t&&(t.isIgnored=!0)},p.unignore=function(e){var t=this.getItem(e);t&&delete t.isIgnored},p.stamp=function(e){(e=this._find(e))&&(this.stamps=this.stamps.concat(e),e.forEach(this.ignore,this))},p.unstamp=function(e){(e=this._find(e))&&e.forEach(function(e){i.removeFrom(this.stamps,e),this.unignore(e)},this)},p._find=function(e){return e?("string"==typeof e&&(e=this.element.querySelectorAll(e)),e=i.makeArray(e)):void 0},p._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},p._getBoundingRect=function(){var e=this.element.getBoundingClientRect(),t=this.size;this._boundingRect={left:e.left+t.paddingLeft+t.borderLeftWidth,top:e.top+t.paddingTop+t.borderTopWidth,right:e.right-(t.paddingRight+t.borderRightWidth),bottom:e.bottom-(t.paddingBottom+t.borderBottomWidth)}},p._manageStamp=c,p._getElementOffset=function(e){var t=e.getBoundingClientRect(),i=this._boundingRect,o=n(e);return{left:t.left-i.left-o.marginLeft,top:t.top-i.top-o.marginTop,right:i.right-t.right-o.marginRight,bottom:i.bottom-t.bottom-o.marginBottom}},p.handleEvent=i.handleEvent,p.bindResize=function(){e.addEventListener("resize",this),this.isResizeBound=!0},p.unbindResize=function(){e.removeEventListener("resize",this),this.isResizeBound=!1},p.onresize=function(){this.resize()},i.debounceMethod(r,"onresize",100),p.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},p.needsResizeLayout=function(){var e=n(this.element);return this.size&&e&&e.innerWidth!==this.size.innerWidth},p.addItems=function(e){var t=this._itemize(e);return t.length&&(this.items=this.items.concat(t)),t},p.appended=function(e){var t=this.addItems(e);t.length&&(this.layoutItems(t,!0),this.reveal(t))},p.prepended=function(e){var t=this._itemize(e);if(t.length){var n=this.items.slice(0);this.items=t.concat(n),this._resetLayout(),this._manageStamps(),this.layoutItems(t,!0),this.reveal(t),this.layoutItems(n)}},p.reveal=function(e){if(this._emitCompleteOnItems("reveal",e),e&&e.length){var t=this.updateStagger();e.forEach(function(e,n){e.stagger(n*t),e.reveal()})}},p.hide=function(e){if(this._emitCompleteOnItems("hide",e),e&&e.length){var t=this.updateStagger();e.forEach(function(e,n){e.stagger(n*t),e.hide()})}},p.revealItemElements=function(e){var t=this.getItems(e);this.reveal(t)},p.hideItemElements=function(e){var t=this.getItems(e);this.hide(t)},p.getItem=function(e){for(var t=0;t<this.items.length;t++){var n=this.items[t];if(n.element==e)return n}},p.getItems=function(e){var t=[];return(e=i.makeArray(e)).forEach(function(e){var n=this.getItem(e);n&&t.push(n)},this),t},p.remove=function(e){var t=this.getItems(e);this._emitCompleteOnItems("remove",t),t&&t.length&&t.forEach(function(e){e.remove(),i.removeFrom(this.items,e)},this)},p.destroy=function(){var e=this.element.style;e.height="",e.position="",e.width="",this.items.forEach(function(e){e.destroy()}),this.unbindResize();var t=this.element.outlayerGUID;delete h[t],delete this.element.outlayerGUID,u&&u.removeData(this.element,this.constructor.namespace)},r.data=function(e){var t=(e=i.getQueryElement(e))&&e.outlayerGUID;return t&&h[t]},r.create=function(e,t){var n=s(r);return n.defaults=i.extend({},r.defaults),i.extend(n.defaults,t),n.compatOptions=i.extend({},r.compatOptions),n.namespace=e,n.data=r.data,n.Item=s(o),i.htmlInit(n,e),u&&u.bridget&&u.bridget(e,n),n};var m={ms:1,s:1e3};return r.Item=o,r}),function(e,t){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("outlayer"),require("get-size")):e.Masonry=t(e.Outlayer,e.getSize)}(window,function(e,t){var n=e.create("masonry");n.compatOptions.fitWidth="isFitWidth";var i=n.prototype;return i._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var e=0;e<this.cols;e++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},i.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var e=this.items[0],n=e&&e.element;this.columnWidth=n&&t(n).outerWidth||this.containerWidth}var i=this.columnWidth+=this.gutter,o=this.containerWidth+this.gutter,r=o/i,s=i-o%i,a=s&&1>s?"round":"floor";r=Math[a](r),this.cols=Math.max(r,1)},i.getContainerWidth=function(){var e=this._getOption("fitWidth")?this.element.parentNode:this.element,n=t(e);this.containerWidth=n&&n.innerWidth},i._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth%this.columnWidth,n=t&&1>t?"round":"ceil",i=Math[n](e.size.outerWidth/this.columnWidth);i=Math.min(i,this.cols);for(var o=this[this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition"](i,e),r={x:this.columnWidth*o.col,y:o.y},s=o.y+e.size.outerHeight,a=i+o.col,l=o.col;a>l;l++)this.colYs[l]=s;return r},i._getTopColPosition=function(e){var t=this._getTopColGroup(e),n=Math.min.apply(Math,t);return{col:t.indexOf(n),y:n}},i._getTopColGroup=function(e){if(2>e)return this.colYs;for(var t=[],n=this.cols+1-e,i=0;n>i;i++)t[i]=this._getColGroupY(i,e);return t},i._getColGroupY=function(e,t){if(2>t)return this.colYs[e];var n=this.colYs.slice(e,e+t);return Math.max.apply(Math,n)},i._getHorizontalColPosition=function(e,t){var n=this.horizontalColIndex%this.cols;n=e>1&&n+e>this.cols?0:n;var i=t.size.outerWidth&&t.size.outerHeight;return this.horizontalColIndex=i?n+e:this.horizontalColIndex,{col:n,y:this._getColGroupY(n,e)}},i._manageStamp=function(e){var n=t(e),i=this._getElementOffset(e),o=this._getOption("originLeft")?i.left:i.right,r=o+n.outerWidth,s=Math.floor(o/this.columnWidth);s=Math.max(0,s);var a=Math.floor(r/this.columnWidth);a-=r%this.columnWidth?0:1,a=Math.min(this.cols-1,a);for(var l=(this._getOption("originTop")?i.top:i.bottom)+n.outerHeight,u=s;a>=u;u++)this.colYs[u]=Math.max(l,this.colYs[u])},i._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var e={height:this.maxY};return this._getOption("fitWidth")&&(e.width=this._getContainerFitWidth()),e},i._getContainerFitWidth=function(){for(var e=0,t=this.cols;--t&&0===this.colYs[t];)e++;return(this.cols-e)*this.columnWidth-this.gutter},i.needsResizeLayout=function(){var e=this.containerWidth;return this.getContainerWidth(),e!=this.containerWidth},n}),$(".close-icon").on("click",function(){$(this).closest(".card").css({display:"none"}),$("#restaurant").fadeIn()})(function(e){"use strict";var t=function(t,n){var i=this,o={allowFreeEntries:!0,allowDuplicates:!1,ajaxConfig:{},autoSelect:!0,selectFirst:!1,queryParam:"query",beforeSend:function(){},cls:"",data:null,dataUrlParams:{},disabled:!1,disabledField:null,displayField:"name",editable:!0,expanded:!1,expandOnFocus:!1,groupBy:null,hideTrigger:!1,highlight:!0,id:null,infoMsgCls:"",inputCfg:{},invalidCls:"ms-inv",matchCase:!1,maxDropHeight:290,maxEntryLength:null,maxEntryRenderer:function(e){return"Please reduce your entry by "+e+" character"+(e>1?"s":"")},maxSuggestions:null,maxSelection:10,maxSelectionRenderer:function(e){return"You cannot choose more than "+e+" item"+(e>1?"s":"")},method:"POST",minChars:0,minCharsRenderer:function(e){return"Please type "+e+" more character"+(e>1?"s":"")},mode:"local",name:null,noSuggestionText:"No suggestions",placeholder:"Type or click here",renderer:null,required:!1,resultAsString:!1,resultAsStringDelimiter:",",resultsField:"results",selectionCls:"",selectionContainer:null,selectionPosition:"inner",selectionRenderer:null,selectionStacked:!1,sortDir:"asc",sortOrder:null,strictSuggest:!1,style:"",toggleOnClick:!1,typeDelay:400,useTabKey:!1,useCommaKey:!0,useZebraStyle:!1,value:null,valueField:"id",vregex:null,vtype:null},r=e.extend({},n),s=e.extend(!0,{},o,r);this.addToSelection=function(t,n){if(!s.maxSelection||l.length<s.maxSelection){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,n){(s.allowDuplicates||-1===e.inArray(n[s.valueField],i.getValue()))&&(l.push(n),o=!0)}),!0===o&&(f._renderSelection(),this.empty(),!0!==n&&e(this).trigger("selectionchange",[this,this.getSelection()]))}this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.clear=function(e){this.removeFromSelection(l.slice(0),e)},this.collapse=function(){!0===s.expanded&&(this.combobox.detach(),s.expanded=!1,e(this).trigger("collapse",[this]))},this.disable=function(){this.container.addClass("ms-ctn-disabled"),s.disabled=!0,i.input.attr("disabled",!0)},this.empty=function(){this.input.val("")},this.enable=function(){this.container.removeClass("ms-ctn-disabled"),s.disabled=!1,i.input.attr("disabled",!1)},this.expand=function(){!s.expanded&&(this.input.val().length>=s.minChars||this.combobox.children().size()>0)&&(this.combobox.appendTo(this.container),f._processSuggestions(),s.expanded=!0,e(this).trigger("expand",[this]))},this.isDisabled=function(){return s.disabled},this.isValid=function(){var t=!1===s.required||l.length>0;return(s.vtype||s.vregex)&&e.each(l,function(e,n){t=t&&f._validateSingleItem(n[s.valueField])}),t},this.getDataUrlParams=function(){return s.dataUrlParams},this.getName=function(){return s.name},this.getSelection=function(){return l},this.getRawValue=function(){return i.input.val()},this.getValue=function(){return e.map(l,function(e){return e[s.valueField]})},this.removeFromSelection=function(t,n){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,n){var r=e.inArray(n[s.valueField],i.getValue());r>-1&&(l.splice(r,1),o=!0)}),!0===o&&(f._renderSelection(),!0!==n&&e(this).trigger("selectionchange",[this,this.getSelection()]),s.expandOnFocus&&i.expand(),s.expanded&&f._processSuggestions()),this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.getData=function(){return h},this.setData=function(e){s.data=e,f._processSuggestions()},this.setName=function(t){s.name=t,t&&(s.name+=t.indexOf("[]")>0?"":"[]"),i._valueContainer&&e.each(i._valueContainer.children(),function(e,t){t.name=s.name})},this.setSelection=function(e){this.clear(),this.addToSelection(e)},this.setValue=function(t){var n=[];e.each(t,function(t,i){var o=!1;if(e.each(h,function(e,t){if(t[s.valueField]==i)return n.push(t),o=!0,!1}),!o)if("object"==typeof i)n.push(i);else{var r={};r[s.valueField]=i,r[s.displayField]=i,n.push(r)}}),n.length>0&&this.addToSelection(n)},this.setDataUrlParams=function(t){s.dataUrlParams=e.extend({},t)};var a,l=[],u=0,c=!1,d=null,h=[],p=!1,m={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESC:27,SPACE:32,UPARROW:38,DOWNARROW:40,COMMA:188},f={_displaySuggestions:function(t){i.combobox.show(),i.combobox.empty();var n=0,o=0;if(null===d)f._renderComboItems(t),n=u*t.length;else{for(var r in d)o+=1,e("<div/>",{class:"ms-res-group",html:r}).appendTo(i.combobox),f._renderComboItems(d[r].items,!0);var a=i.combobox.find(".ms-res-group").outerHeight();if(null!==a){var l=o*a;n=u*t.length+l}else n=u*(t.length+o)}if(n<i.combobox.height()||n<=s.maxDropHeight?i.combobox.height(n):n>=i.combobox.height()&&n>s.maxDropHeight&&i.combobox.height(s.maxDropHeight),1===t.length&&!0===s.autoSelect&&i.combobox.children().filter(":not(.ms-res-item-disabled):last").addClass("ms-res-item-active"),!0===s.selectFirst&&i.combobox.children().filter(":not(.ms-res-item-disabled):first").addClass("ms-res-item-active"),0===t.length&&""!==i.getRawValue()){var c=s.noSuggestionText.replace(/\{\{.*\}\}/,i.input.val());f._updateHelper(c),i.collapse()}!1===s.allowFreeEntries&&(0===t.length?(e(i.input).addClass(s.invalidCls),i.combobox.hide()):e(i.input).removeClass(s.invalidCls))},_getEntriesFromStringArray:function(t){var n=[];return e.each(t,function(t,i){var o={};o[s.displayField]=o[s.valueField]=e.trim(i),n.push(o)}),n},_highlightSuggestion:function(t){var n=i.input.val(),o=["^","$","*","+","?",".","(",")",":","!","|","{","}","[","]"];if(e.each(o,function(e,t){n=n.replace(t,"\\"+t)}),0===n.length)return t;var r=!0===s.matchCase?"g":"gi";return t.replace(new RegExp("("+n+")(?!([^<]+)?>)",r),"<em>$1</em>")},_moveSelectedRow:function(e){s.expanded||i.expand();var t,n,o,r;t=i.combobox.find(".ms-res-item:not(.ms-res-item-disabled)"),n="down"===e?t.eq(0):t.filter(":last"),(o=i.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0&&("down"===e?(0===(n=o.nextAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(n=t.eq(0)),r=i.combobox.scrollTop(),i.combobox.scrollTop(0),n[0].offsetTop+n.outerHeight()>i.combobox.height()&&i.combobox.scrollTop(r+u)):(0===(n=o.prevAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(n=t.filter(":last"),i.combobox.scrollTop(u*t.length)),n[0].offsetTop<i.combobox.scrollTop()&&i.combobox.scrollTop(i.combobox.scrollTop()-u))),t.removeClass("ms-res-item-active"),n.addClass("ms-res-item-active")},_processSuggestions:function(t){var n=null,o=t||s.data;if(null!==o){if("function"==typeof o&&(o=o.call(i,i.getRawValue())),"string"==typeof o){e(i).trigger("beforeload",[i]);var r={};r[s.queryParam]=i.input.val();var a=e.extend(r,s.dataUrlParams);return void e.ajax(e.extend({type:s.method,url:o,data:a,beforeSend:s.beforeSend,success:function(t){n="string"==typeof t?JSON.parse(t):t,f._processSuggestions(n),e(i).trigger("load",[i,n]),f._asyncValues&&(i.setValue("string"==typeof f._asyncValues?JSON.parse(f._asyncValues):f._asyncValues),f._renderSelection(),delete f._asyncValues)},error:function(){throw"Could not reach server"}},s.ajaxConfig))}h=o.length>0&&"string"==typeof o[0]?f._getEntriesFromStringArray(o):o[s.resultsField]||o;var l="remote"===s.mode?h:f._sortAndTrim(h);f._displaySuggestions(f._group(l))}},_render:function(t){if(i.setName(s.name),i.container=e("<div/>",{class:"ms-ctn form-control "+(s.resultAsString?"ms-as-string ":"")+s.cls+(e(t).hasClass("input-lg")?" input-lg":"")+(e(t).hasClass("input-sm")?" input-sm":"")+(!0===s.disabled?" ms-ctn-disabled":"")+(!0===s.editable?"":" ms-ctn-readonly")+(!1===s.hideTrigger?"":" ms-no-trigger"),style:s.style,id:s.id}),i.container.focus(e.proxy(g._onFocus,this)),i.container.blur(e.proxy(g._onBlur,this)),i.container.keydown(e.proxy(g._onKeyDown,this)),i.container.keyup(e.proxy(g._onKeyUp,this)),i.input=e("<input/>",e.extend({type:"text",class:!0===s.editable?"":" ms-input-readonly",readonly:!s.editable,placeholder:s.placeholder,disabled:s.disabled},s.inputCfg)),i.input.focus(e.proxy(g._onInputFocus,this)),i.input.click(e.proxy(g._onInputClick,this)),i.combobox=e("<div/>",{class:"ms-res-ctn dropdown-menu"}).height(s.maxDropHeight),i.combobox.on("click","div.ms-res-item",e.proxy(g._onComboItemSelected,this)),i.combobox.on("mouseover","div.ms-res-item",e.proxy(g._onComboItemMouseOver,this)),s.selectionContainer?(i.selectionContainer=s.selectionContainer,e(i.selectionContainer).addClass("ms-sel-ctn")):i.selectionContainer=e("<div/>",{class:"ms-sel-ctn"}),i.selectionContainer.click(e.proxy(g._onFocus,this)),"inner"!==s.selectionPosition||s.selectionContainer?i.container.append(i.input):i.selectionContainer.append(i.input),i.helper=e("<span/>",{class:"ms-helper "+s.infoMsgCls}),f._updateHelper(),i.container.append(i.helper),e(t).replaceWith(i.container),!s.selectionContainer)switch(s.selectionPosition){case"bottom":i.selectionContainer.insertAfter(i.container),!0===s.selectionStacked&&(i.selectionContainer.width(i.container.width()),i.selectionContainer.addClass("ms-stacked"));break;case"right":i.selectionContainer.insertAfter(i.container),i.container.css("float","left");break;default:i.container.append(i.selectionContainer)}!1===s.hideTrigger&&(i.trigger=e("<div/>",{class:"ms-trigger",html:'<div class="ms-trigger-ico"></div>'}),i.trigger.click(e.proxy(g._onTriggerClick,this)),i.container.append(i.trigger)),e(window).resize(e.proxy(g._onWindowResized,this)),null===s.value&&null===s.data||("string"==typeof s.data?(f._asyncValues=s.value,f._processSuggestions()):(f._processSuggestions(),null!==s.value&&(i.setValue(s.value),f._renderSelection()))),e("body").click(function(e){i.container.hasClass("ms-ctn-focus")&&0===i.container.has(e.target).length&&e.target.className.indexOf("ms-res-item")<0&&e.target.className.indexOf("ms-close-btn")<0&&i.container[0]!==e.target&&g._onBlur()}),!0===s.expanded&&(s.expanded=!1,i.expand())},_renderComboItems:function(t,n){var o=this,r="";e.each(t,function(t,i){var a=null!==s.renderer?s.renderer.call(o,i):i[s.displayField],l=null!==s.disabledField&&!0===i[s.disabledField],u=e("<div/>",{class:"ms-res-item "+(n?"ms-res-item-grouped ":"")+(l?"ms-res-item-disabled ":"")+(t%2==1&&!0===s.useZebraStyle?"ms-res-odd":""),html:!0===s.highlight?f._highlightSuggestion(a):a,"data-json":JSON.stringify(i)});r+=e("<div/>").append(u).html()}),i.combobox.append(r),u=i.combobox.find(".ms-res-item:first").outerHeight()},_renderSelection:function(){var t=this,n=0,o=0,r=[],a=!0===s.resultAsString&&!c;i.selectionContainer.find(".ms-sel-item").remove(),void 0!==i._valueContainer&&i._valueContainer.remove(),e.each(l,function(n,i){var o,u=null!==s.selectionRenderer?s.selectionRenderer.call(t,i):i[s.displayField],c=f._validateSingleItem(i[s.displayField])?"":" ms-sel-invalid";!0===a?o=e("<div/>",{class:"ms-sel-item ms-sel-text "+s.selectionCls+c,html:u+(n===l.length-1?"":s.resultAsStringDelimiter)}).data("json",i):(o=e("<div/>",{class:"ms-sel-item "+s.selectionCls+c,html:u}).data("json",i),!1===s.disabled&&e("<span/>",{class:"ms-close-btn"}).data("json",i).appendTo(o).click(e.proxy(g._onTagTriggerClick,t))),r.push(o)}),i.selectionContainer.prepend(r),i._valueContainer=e("<div/>",{style:"display: none;"}),e.each(i.getValue(),function(t,n){e("<input/>",{type:"hidden",name:s.name,value:n}).appendTo(i._valueContainer)}),i._valueContainer.appendTo(i.selectionContainer),"inner"!==s.selectionPosition||s.selectionContainer||(i.input.width(0),o=i.input.offset().left-i.selectionContainer.offset().left,n=i.container.width()-o-42,i.input.width(n)),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):i.helper.hide()},_selectItem:function(e){1===s.maxSelection&&(l=[]),i.addToSelection(e.data("json")),e.removeClass("ms-res-item-active"),!1!==s.expandOnFocus&&l.length!==s.maxSelection||i.collapse(),c?c&&(s.expandOnFocus||p)&&(f._processSuggestions(),p&&i.expand()):i.input.focus()},_sortAndTrim:function(t){var n=i.getRawValue(),o=[],r=[],a=i.getValue();return n.length>0?e.each(t,function(e,t){var i=t[s.displayField];(!0===s.matchCase&&i.indexOf(n)>-1||!1===s.matchCase&&i.toLowerCase().indexOf(n.toLowerCase())>-1)&&(!1!==s.strictSuggest&&0!==i.toLowerCase().indexOf(n.toLowerCase())||o.push(t))}):o=t,e.each(o,function(t,n){(s.allowDuplicates||-1===e.inArray(n[s.valueField],a))&&r.push(n)}),null!==s.sortOrder&&r.sort(function(e,t){return e[s.sortOrder]<t[s.sortOrder]?"asc"===s.sortDir?-1:1:e[s.sortOrder]>t[s.sortOrder]?"asc"===s.sortDir?1:-1:0}),s.maxSuggestions&&s.maxSuggestions>0&&(r=r.slice(0,s.maxSuggestions)),r},_group:function(t){return null!==s.groupBy&&(d={},e.each(t,function(e,t){var n=s.groupBy.indexOf(".")>-1?s.groupBy.split("."):s.groupBy,i=t[s.groupBy];if("string"!=typeof n)for(i=t;n.length>0;)i=i[n.shift()];void 0===d[i]?d[i]={title:i,items:[t]}:d[i].items.push(t)})),t},_updateHelper:function(e){i.helper.html(e),i.helper.is(":visible")||i.helper.fadeIn()},_validateSingleItem:function(e){if(null!==s.vregex&&s.vregex instanceof RegExp)return s.vregex.test(e);if(null!==s.vtype)switch(s.vtype){case"alpha":return/^[a-zA-Z_]+$/.test(e);case"alphanum":return/^[a-zA-Z0-9_]+$/.test(e);case"email":return/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/.test(e);case"url":return/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i.test(e);case"ipaddress":return/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)}return!0}},g={_onBlur:function(){if(i.container.removeClass("ms-ctn-focus"),i.collapse(),c=!1,""!==i.getRawValue()&&!0===s.allowFreeEntries){var t={};t[s.displayField]=t[s.valueField]=i.getRawValue().trim(),i.addToSelection(t)}f._renderSelection(),!1===i.isValid()?i.container.addClass(s.invalidCls):""!==i.input.val()&&!1===s.allowFreeEntries&&(i.empty(),f._updateHelper("")),e(i).trigger("blur",[i])},_onComboItemMouseOver:function(t){var n=e(t.currentTarget);n.hasClass("ms-res-item-disabled")||(i.combobox.children().removeClass("ms-res-item-active"),n.addClass("ms-res-item-active"))},_onComboItemSelected:function(t){e(t.currentTarget).hasClass("ms-res-item-disabled")||f._selectItem(e(t.currentTarget))},_onFocus:function(){i.input.focus()},_onInputClick:function(){!1===i.isDisabled()&&c&&!0===s.toggleOnClick&&(s.expanded?i.collapse():i.expand())},_onInputFocus:function(){if(!1===i.isDisabled()&&!c){c=!0,i.container.addClass("ms-ctn-focus"),i.container.removeClass(s.invalidCls);var t=i.getRawValue().length;!0===s.expandOnFocus&&i.expand(),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):t<s.minChars&&f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t)),f._renderSelection(),e(i).trigger("focus",[i])}},_onKeyDown:function(t){var n=i.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first"),o=i.input.val();if(e(i).trigger("keydown",[i,t]),t.keyCode!==m.TAB||!1!==s.useTabKey&&(!0!==s.useTabKey||0!==n.length||0!==i.input.val().length))switch(t.keyCode){case m.BACKSPACE:0===o.length&&i.getSelection().length>0&&"inner"===s.selectionPosition&&(l.pop(),f._renderSelection(),e(i).trigger("selectionchange",[i,i.getSelection()]),i.input.attr("placeholder","inner"===s.selectionPosition&&i.getValue().length>0?"":s.placeholder),i.input.focus(),t.preventDefault());break;case m.TAB:case m.ESC:t.preventDefault();break;case m.ENTER:(""!==o||s.expanded)&&t.preventDefault();break;case m.COMMA:!0===s.useCommaKey&&t.preventDefault();break;case m.CTRL:p=!0;break;case m.DOWNARROW:t.preventDefault(),f._moveSelectedRow("down");break;case m.UPARROW:t.preventDefault(),f._moveSelectedRow("up");break;default:l.length===s.maxSelection&&t.preventDefault()}else g._onBlur()},_onKeyUp:function(t){var n,o=i.getRawValue(),r=e.trim(i.input.val()).length>0&&(!s.maxEntryLength||e.trim(i.input.val()).length<=s.maxEntryLength),u={};if(e(i).trigger("keyup",[i,t]),clearTimeout(a),t.keyCode===m.ESC&&s.expanded&&i.combobox.hide(),t.keyCode===m.TAB&&!1===s.useTabKey||t.keyCode>m.ENTER&&t.keyCode<m.SPACE)t.keyCode===m.CTRL&&(p=!1);else switch(t.keyCode){case m.UPARROW:case m.DOWNARROW:t.preventDefault();break;case m.ENTER:case m.TAB:case m.COMMA:if(t.keyCode!==m.COMMA||!0===s.useCommaKey){if(t.preventDefault(),!0===s.expanded&&(n=i.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0)return void f._selectItem(n);!0===r&&!0===s.allowFreeEntries&&(u[s.displayField]=u[s.valueField]=o.trim(),i.addToSelection(u),i.collapse(),i.input.focus());break}default:l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):o.length<s.minChars?(f._updateHelper(s.minCharsRenderer.call(this,s.minChars-o.length)),!0===s.expanded&&i.collapse()):s.maxEntryLength&&o.length>s.maxEntryLength?(f._updateHelper(s.maxEntryRenderer.call(this,o.length-s.maxEntryLength)),!0===s.expanded&&i.collapse()):(i.helper.hide(),s.minChars<=o.length&&(a=setTimeout(function(){!0===s.expanded?f._processSuggestions():i.expand()},s.typeDelay)))}},_onTagTriggerClick:function(t){i.removeFromSelection(e(t.currentTarget).data("json"))},_onTriggerClick:function(){if(!1===i.isDisabled()&&(!0!==s.expandOnFocus||l.length!==s.maxSelection))if(e(i).trigger("triggerclick",[i]),!0===s.expanded)i.collapse();else{var t=i.getRawValue().length;t>=s.minChars?(i.input.focus(),i.expand()):f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t))}},_onWindowResized:function(){f._renderSelection()}};null!==t&&f._render(t)};e.fn.magicSuggest=function(n){var i=e(this);return 1===i.size()&&i.data("magicSuggest")?i.data("magicSuggest"):(i.each(function(i){var o=e(this);if(!o.data("magicSuggest")){"select"===this.nodeName.toLowerCase()&&(n.data=[],n.value=[],e.each(this.children,function(t,i){i.nodeName&&"option"===i.nodeName.toLowerCase()&&(n.data.push({id:i.value,name:i.text}),e(i).attr("selected")&&n.value.push(i.value))}));var r={};e.each(this.attributes,function(e,t){r[t.name]="value"===t.name&&""!==t.value?JSON.parse(t.value):t.value});var s=new t(this,e.extend([],e.fn.magicSuggest.defaults,n,r));o.data("magicSuggest",s),s.container.data("magicSuggest",s)}}),1===i.size()?i.data("magicSuggest"):i)},e.fn.magicSuggest.defaults={}})(jQuery),function(e){"use strict";var t=function(t,n){var i=this,o={allowFreeEntries:!0,allowDuplicates:!1,ajaxConfig:{},autoSelect:!0,selectFirst:!1,queryParam:"query",beforeSend:function(){},cls:"",data:null,dataUrlParams:{},disabled:!1,disabledField:null,displayField:"name",editable:!0,expanded:!1,expandOnFocus:!1,groupBy:null,hideTrigger:!1,highlight:!0,id:null,infoMsgCls:"",inputCfg:{},invalidCls:"ms-inv",matchCase:!1,maxDropHeight:290,maxEntryLength:null,maxEntryRenderer:function(e){return"Please reduce your entry by "+e+" character"+(e>1?"s":"")},maxSuggestions:null,maxSelection:10,maxSelectionRenderer:function(e){return"You cannot choose more than "+e+" item"+(e>1?"s":"")},method:"POST",minChars:0,minCharsRenderer:function(e){return"Please type "+e+" more character"+(e>1?"s":"")},mode:"local",name:null,noSuggestionText:"No suggestions",placeholder:"Type or click here",renderer:null,required:!1,resultAsString:!1,resultAsStringDelimiter:",",resultsField:"results",selectionCls:"",selectionContainer:null,selectionPosition:"inner",selectionRenderer:null,selectionStacked:!1,sortDir:"asc",sortOrder:null,strictSuggest:!1,style:"",toggleOnClick:!1,typeDelay:400,useTabKey:!1,useCommaKey:!0,useZebraStyle:!1,value:null,valueField:"id",vregex:null,vtype:null},r=e.extend({},n),s=e.extend(!0,{},o,r);this.addToSelection=function(t,n){if(!s.maxSelection||l.length<s.maxSelection){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,n){(s.allowDuplicates||-1===e.inArray(n[s.valueField],i.getValue()))&&(l.push(n),o=!0)}),!0===o&&(f._renderSelection(),this.empty(),!0!==n&&e(this).trigger("selectionchange",[this,this.getSelection()]))}this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.clear=function(e){this.removeFromSelection(l.slice(0),e)},this.collapse=function(){!0===s.expanded&&(this.combobox.detach(),s.expanded=!1,e(this).trigger("collapse",[this]))},this.disable=function(){this.container.addClass("ms-ctn-disabled"),s.disabled=!0,i.input.attr("disabled",!0)},this.empty=function(){this.input.val("")},this.enable=function(){this.container.removeClass("ms-ctn-disabled"),s.disabled=!1,i.input.attr("disabled",!1)},this.expand=function(){!s.expanded&&(this.input.val().length>=s.minChars||this.combobox.children().size()>0)&&(this.combobox.appendTo(this.container),f._processSuggestions(),s.expanded=!0,e(this).trigger("expand",[this]))},this.isDisabled=function(){return s.disabled},this.isValid=function(){var t=!1===s.required||l.length>0;return(s.vtype||s.vregex)&&e.each(l,function(e,n){t=t&&f._validateSingleItem(n[s.valueField])}),t},this.getDataUrlParams=function(){return s.dataUrlParams},this.getName=function(){return s.name},this.getSelection=function(){return l},this.getRawValue=function(){return i.input.val()},this.getValue=function(){return e.map(l,function(e){return e[s.valueField]})},this.removeFromSelection=function(t,n){e.isArray(t)||(t=[t]);var o=!1;e.each(t,function(t,n){var r=e.inArray(n[s.valueField],i.getValue());r>-1&&(l.splice(r,1),o=!0)}),!0===o&&(f._renderSelection(),!0!==n&&e(this).trigger("selectionchange",[this,this.getSelection()]),s.expandOnFocus&&i.expand(),s.expanded&&f._processSuggestions()),this.input.attr("placeholder","inner"===s.selectionPosition&&this.getValue().length>0?"":s.placeholder)},this.getData=function(){return h},this.setData=function(e){s.data=e,f._processSuggestions()},this.setName=function(t){s.name=t,t&&(s.name+=t.indexOf("[]")>0?"":"[]"),i._valueContainer&&e.each(i._valueContainer.children(),function(e,t){t.name=s.name})},this.setSelection=function(e){this.clear(),this.addToSelection(e)},this.setValue=function(t){var n=[];e.each(t,function(t,i){var o=!1;if(e.each(h,function(e,t){if(t[s.valueField]==i)return n.push(t),o=!0,!1}),!o)if("object"==typeof i)n.push(i);else{var r={};r[s.valueField]=i,r[s.displayField]=i,n.push(r)}}),n.length>0&&this.addToSelection(n)},this.setDataUrlParams=function(t){s.dataUrlParams=e.extend({},t)};var a,l=[],u=0,c=!1,d=null,h=[],p=!1,m={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESC:27,SPACE:32,UPARROW:38,DOWNARROW:40,COMMA:188},f={_displaySuggestions:function(t){i.combobox.show(),i.combobox.empty();var n=0,o=0;if(null===d)f._renderComboItems(t),n=u*t.length;else{for(var r in d)o+=1,e("<div/>",{class:"ms-res-group",html:r}).appendTo(i.combobox),f._renderComboItems(d[r].items,!0);var a=i.combobox.find(".ms-res-group").outerHeight();if(null!==a){var l=o*a;n=u*t.length+l}else n=u*(t.length+o)}if(n<i.combobox.height()||n<=s.maxDropHeight?i.combobox.height(n):n>=i.combobox.height()&&n>s.maxDropHeight&&i.combobox.height(s.maxDropHeight),1===t.length&&!0===s.autoSelect&&i.combobox.children().filter(":not(.ms-res-item-disabled):last").addClass("ms-res-item-active"),!0===s.selectFirst&&i.combobox.children().filter(":not(.ms-res-item-disabled):first").addClass("ms-res-item-active"),0===t.length&&""!==i.getRawValue()){var c=s.noSuggestionText.replace(/\{\{.*\}\}/,i.input.val());f._updateHelper(c),i.collapse()}!1===s.allowFreeEntries&&(0===t.length?(e(i.input).addClass(s.invalidCls),i.combobox.hide()):e(i.input).removeClass(s.invalidCls))},_getEntriesFromStringArray:function(t){var n=[];return e.each(t,function(t,i){var o={};o[s.displayField]=o[s.valueField]=e.trim(i),n.push(o)}),n},_highlightSuggestion:function(t){var n=i.input.val(),o=["^","$","*","+","?",".","(",")",":","!","|","{","}","[","]"];if(e.each(o,function(e,t){n=n.replace(t,"\\"+t)}),0===n.length)return t;var r=!0===s.matchCase?"g":"gi";return t.replace(new RegExp("("+n+")(?!([^<]+)?>)",r),"<em>$1</em>")},_moveSelectedRow:function(e){s.expanded||i.expand();var t,n,o,r;t=i.combobox.find(".ms-res-item:not(.ms-res-item-disabled)"),n="down"===e?t.eq(0):t.filter(":last"),(o=i.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0&&("down"===e?(0===(n=o.nextAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(n=t.eq(0)),r=i.combobox.scrollTop(),i.combobox.scrollTop(0),n[0].offsetTop+n.outerHeight()>i.combobox.height()&&i.combobox.scrollTop(r+u)):(0===(n=o.prevAll(".ms-res-item:not(.ms-res-item-disabled)").first()).length&&(n=t.filter(":last"),i.combobox.scrollTop(u*t.length)),n[0].offsetTop<i.combobox.scrollTop()&&i.combobox.scrollTop(i.combobox.scrollTop()-u))),t.removeClass("ms-res-item-active"),n.addClass("ms-res-item-active")},_processSuggestions:function(t){var n=null,o=t||s.data;if(null!==o){if("function"==typeof o&&(o=o.call(i,i.getRawValue())),"string"==typeof o){e(i).trigger("beforeload",[i]);var r={};r[s.queryParam]=i.input.val();var a=e.extend(r,s.dataUrlParams);return void e.ajax(e.extend({type:s.method,url:o,data:a,beforeSend:s.beforeSend,success:function(t){n="string"==typeof t?JSON.parse(t):t,f._processSuggestions(n),e(i).trigger("load",[i,n]),f._asyncValues&&(i.setValue("string"==typeof f._asyncValues?JSON.parse(f._asyncValues):f._asyncValues),f._renderSelection(),delete f._asyncValues)},error:function(){throw"Could not reach server"}},s.ajaxConfig))}h=o.length>0&&"string"==typeof o[0]?f._getEntriesFromStringArray(o):o[s.resultsField]||o;var l="remote"===s.mode?h:f._sortAndTrim(h);f._displaySuggestions(f._group(l))}},_render:function(t){if(i.setName(s.name),i.container=e("<div/>",{class:"ms-ctn form-control "+(s.resultAsString?"ms-as-string ":"")+s.cls+(e(t).hasClass("input-lg")?" input-lg":"")+(e(t).hasClass("input-sm")?" input-sm":"")+(!0===s.disabled?" ms-ctn-disabled":"")+(!0===s.editable?"":" ms-ctn-readonly")+(!1===s.hideTrigger?"":" ms-no-trigger"),style:s.style,id:s.id}),i.container.focus(e.proxy(g._onFocus,this)),i.container.blur(e.proxy(g._onBlur,this)),i.container.keydown(e.proxy(g._onKeyDown,this)),i.container.keyup(e.proxy(g._onKeyUp,this)),i.input=e("<input/>",e.extend({type:"text",class:!0===s.editable?"":" ms-input-readonly",readonly:!s.editable,placeholder:s.placeholder,disabled:s.disabled},s.inputCfg)),i.input.focus(e.proxy(g._onInputFocus,this)),i.input.click(e.proxy(g._onInputClick,this)),i.combobox=e("<div/>",{class:"ms-res-ctn dropdown-menu"}).height(s.maxDropHeight),i.combobox.on("click","div.ms-res-item",e.proxy(g._onComboItemSelected,this)),i.combobox.on("mouseover","div.ms-res-item",e.proxy(g._onComboItemMouseOver,this)),s.selectionContainer?(i.selectionContainer=s.selectionContainer,e(i.selectionContainer).addClass("ms-sel-ctn")):i.selectionContainer=e("<div/>",{class:"ms-sel-ctn"}),i.selectionContainer.click(e.proxy(g._onFocus,this)),"inner"!==s.selectionPosition||s.selectionContainer?i.container.append(i.input):i.selectionContainer.append(i.input),i.helper=e("<span/>",{class:"ms-helper "+s.infoMsgCls}),f._updateHelper(),i.container.append(i.helper),e(t).replaceWith(i.container),!s.selectionContainer)switch(s.selectionPosition){case"bottom":i.selectionContainer.insertAfter(i.container),!0===s.selectionStacked&&(i.selectionContainer.width(i.container.width()),i.selectionContainer.addClass("ms-stacked"));break;case"right":i.selectionContainer.insertAfter(i.container),i.container.css("float","left");break;default:i.container.append(i.selectionContainer)}!1===s.hideTrigger&&(i.trigger=e("<div/>",{class:"ms-trigger",html:'<div class="ms-trigger-ico"></div>'}),i.trigger.click(e.proxy(g._onTriggerClick,this)),i.container.append(i.trigger)),e(window).resize(e.proxy(g._onWindowResized,this)),null===s.value&&null===s.data||("string"==typeof s.data?(f._asyncValues=s.value,f._processSuggestions()):(f._processSuggestions(),null!==s.value&&(i.setValue(s.value),f._renderSelection()))),e("body").click(function(e){i.container.hasClass("ms-ctn-focus")&&0===i.container.has(e.target).length&&e.target.className.indexOf("ms-res-item")<0&&e.target.className.indexOf("ms-close-btn")<0&&i.container[0]!==e.target&&g._onBlur()}),!0===s.expanded&&(s.expanded=!1,i.expand())},_renderComboItems:function(t,n){var o=this,r="";e.each(t,function(t,i){var a=null!==s.renderer?s.renderer.call(o,i):i[s.displayField],l=null!==s.disabledField&&!0===i[s.disabledField],u=e("<div/>",{class:"ms-res-item "+(n?"ms-res-item-grouped ":"")+(l?"ms-res-item-disabled ":"")+(t%2==1&&!0===s.useZebraStyle?"ms-res-odd":""),html:!0===s.highlight?f._highlightSuggestion(a):a,"data-json":JSON.stringify(i)});r+=e("<div/>").append(u).html()}),i.combobox.append(r),u=i.combobox.find(".ms-res-item:first").outerHeight()},_renderSelection:function(){var t=this,n=0,o=0,r=[],a=!0===s.resultAsString&&!c;i.selectionContainer.find(".ms-sel-item").remove(),void 0!==i._valueContainer&&i._valueContainer.remove(),e.each(l,function(n,i){var o,u=null!==s.selectionRenderer?s.selectionRenderer.call(t,i):i[s.displayField],c=f._validateSingleItem(i[s.displayField])?"":" ms-sel-invalid";!0===a?o=e("<div/>",{class:"ms-sel-item ms-sel-text "+s.selectionCls+c,html:u+(n===l.length-1?"":s.resultAsStringDelimiter)}).data("json",i):(o=e("<div/>",{class:"ms-sel-item "+s.selectionCls+c,html:u}).data("json",i),!1===s.disabled&&e("<span/>",{class:"ms-close-btn"}).data("json",i).appendTo(o).click(e.proxy(g._onTagTriggerClick,t))),r.push(o)}),i.selectionContainer.prepend(r),i._valueContainer=e("<div/>",{style:"display: none;"}),e.each(i.getValue(),function(t,n){e("<input/>",{type:"hidden",name:s.name,value:n}).appendTo(i._valueContainer)}),i._valueContainer.appendTo(i.selectionContainer),"inner"!==s.selectionPosition||s.selectionContainer||(i.input.width(0),o=i.input.offset().left-i.selectionContainer.offset().left,n=i.container.width()-o-42,i.input.width(n)),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):i.helper.hide()},_selectItem:function(e){1===s.maxSelection&&(l=[]),i.addToSelection(e.data("json")),e.removeClass("ms-res-item-active"),!1!==s.expandOnFocus&&l.length!==s.maxSelection||i.collapse(),c?c&&(s.expandOnFocus||p)&&(f._processSuggestions(),p&&i.expand()):i.input.focus()},_sortAndTrim:function(t){var n=i.getRawValue(),o=[],r=[],a=i.getValue();return n.length>0?e.each(t,function(e,t){var i=t[s.displayField];(!0===s.matchCase&&i.indexOf(n)>-1||!1===s.matchCase&&i.toLowerCase().indexOf(n.toLowerCase())>-1)&&(!1!==s.strictSuggest&&0!==i.toLowerCase().indexOf(n.toLowerCase())||o.push(t))}):o=t,e.each(o,function(t,n){(s.allowDuplicates||-1===e.inArray(n[s.valueField],a))&&r.push(n)}),null!==s.sortOrder&&r.sort(function(e,t){return e[s.sortOrder]<t[s.sortOrder]?"asc"===s.sortDir?-1:1:e[s.sortOrder]>t[s.sortOrder]?"asc"===s.sortDir?1:-1:0}),s.maxSuggestions&&s.maxSuggestions>0&&(r=r.slice(0,s.maxSuggestions)),r},_group:function(t){return null!==s.groupBy&&(d={},e.each(t,function(e,t){var n=s.groupBy.indexOf(".")>-1?s.groupBy.split("."):s.groupBy,i=t[s.groupBy];if("string"!=typeof n)for(i=t;n.length>0;)i=i[n.shift()];void 0===d[i]?d[i]={title:i,items:[t]}:d[i].items.push(t)})),t},_updateHelper:function(e){i.helper.html(e),i.helper.is(":visible")||i.helper.fadeIn()},_validateSingleItem:function(e){if(null!==s.vregex&&s.vregex instanceof RegExp)return s.vregex.test(e);if(null!==s.vtype)switch(s.vtype){case"alpha":return/^[a-zA-Z_]+$/.test(e);case"alphanum":return/^[a-zA-Z0-9_]+$/.test(e);case"email":return/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/.test(e);case"url":return/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i.test(e);case"ipaddress":return/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)}return!0}},g={_onBlur:function(){if(i.container.removeClass("ms-ctn-focus"),i.collapse(),c=!1,""!==i.getRawValue()&&!0===s.allowFreeEntries){var t={};t[s.displayField]=t[s.valueField]=i.getRawValue().trim(),i.addToSelection(t)}f._renderSelection(),!1===i.isValid()?i.container.addClass(s.invalidCls):""!==i.input.val()&&!1===s.allowFreeEntries&&(i.empty(),f._updateHelper("")),e(i).trigger("blur",[i])},_onComboItemMouseOver:function(t){var n=e(t.currentTarget);n.hasClass("ms-res-item-disabled")||(i.combobox.children().removeClass("ms-res-item-active"),n.addClass("ms-res-item-active"))},_onComboItemSelected:function(t){e(t.currentTarget).hasClass("ms-res-item-disabled")||f._selectItem(e(t.currentTarget))},_onFocus:function(){i.input.focus()},_onInputClick:function(){!1===i.isDisabled()&&c&&!0===s.toggleOnClick&&(s.expanded?i.collapse():i.expand())},_onInputFocus:function(){if(!1===i.isDisabled()&&!c){c=!0,i.container.addClass("ms-ctn-focus"),i.container.removeClass(s.invalidCls);var t=i.getRawValue().length;!0===s.expandOnFocus&&i.expand(),l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):t<s.minChars&&f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t)),f._renderSelection(),e(i).trigger("focus",[i])}},_onKeyDown:function(t){var n=i.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first"),o=i.input.val();if(e(i).trigger("keydown",[i,t]),t.keyCode!==m.TAB||!1!==s.useTabKey&&(!0!==s.useTabKey||0!==n.length||0!==i.input.val().length))switch(t.keyCode){case m.BACKSPACE:0===o.length&&i.getSelection().length>0&&"inner"===s.selectionPosition&&(l.pop(),f._renderSelection(),e(i).trigger("selectionchange",[i,i.getSelection()]),i.input.attr("placeholder","inner"===s.selectionPosition&&i.getValue().length>0?"":s.placeholder),i.input.focus(),t.preventDefault());break;case m.TAB:case m.ESC:t.preventDefault();break;case m.ENTER:(""!==o||s.expanded)&&t.preventDefault();break;case m.COMMA:!0===s.useCommaKey&&t.preventDefault();break;case m.CTRL:p=!0;break;case m.DOWNARROW:t.preventDefault(),f._moveSelectedRow("down");break;case m.UPARROW:t.preventDefault(),f._moveSelectedRow("up");break;default:l.length===s.maxSelection&&t.preventDefault()}else g._onBlur()},_onKeyUp:function(t){var n,o=i.getRawValue(),r=e.trim(i.input.val()).length>0&&(!s.maxEntryLength||e.trim(i.input.val()).length<=s.maxEntryLength),u={};if(e(i).trigger("keyup",[i,t]),clearTimeout(a),t.keyCode===m.ESC&&s.expanded&&i.combobox.hide(),t.keyCode===m.TAB&&!1===s.useTabKey||t.keyCode>m.ENTER&&t.keyCode<m.SPACE)t.keyCode===m.CTRL&&(p=!1);else switch(t.keyCode){case m.UPARROW:case m.DOWNARROW:t.preventDefault();break;case m.ENTER:case m.TAB:case m.COMMA:if(t.keyCode!==m.COMMA||!0===s.useCommaKey){if(t.preventDefault(),!0===s.expanded&&(n=i.combobox.find(".ms-res-item-active:not(.ms-res-item-disabled):first")).length>0)return void f._selectItem(n);!0===r&&!0===s.allowFreeEntries&&(u[s.displayField]=u[s.valueField]=o.trim(),i.addToSelection(u),i.collapse(),i.input.focus());break}default:l.length===s.maxSelection?f._updateHelper(s.maxSelectionRenderer.call(this,l.length)):o.length<s.minChars?(f._updateHelper(s.minCharsRenderer.call(this,s.minChars-o.length)),!0===s.expanded&&i.collapse()):s.maxEntryLength&&o.length>s.maxEntryLength?(f._updateHelper(s.maxEntryRenderer.call(this,o.length-s.maxEntryLength)),!0===s.expanded&&i.collapse()):(i.helper.hide(),s.minChars<=o.length&&(a=setTimeout(function(){!0===s.expanded?f._processSuggestions():i.expand()},s.typeDelay)))}},_onTagTriggerClick:function(t){i.removeFromSelection(e(t.currentTarget).data("json"))},_onTriggerClick:function(){if(!1===i.isDisabled()&&(!0!==s.expandOnFocus||l.length!==s.maxSelection))if(e(i).trigger("triggerclick",[i]),!0===s.expanded)i.collapse();else{var t=i.getRawValue().length;t>=s.minChars?(i.input.focus(),i.expand()):f._updateHelper(s.minCharsRenderer.call(this,s.minChars-t))}},_onWindowResized:function(){f._renderSelection()}};null!==t&&f._render(t)};e.fn.magicSuggest=function(n){var i=e(this);return 1===i.size()&&i.data("magicSuggest")?i.data("magicSuggest"):(i.each(function(i){var o=e(this);if(!o.data("magicSuggest")){"select"===this.nodeName.toLowerCase()&&(n.data=[],n.value=[],e.each(this.children,function(t,i){i.nodeName&&"option"===i.nodeName.toLowerCase()&&(n.data.push({id:i.value,name:i.text}),e(i).attr("selected")&&n.value.push(i.value))}));var r={};e.each(this.attributes,function(e,t){r[t.name]="value"===t.name&&""!==t.value?JSON.parse(t.value):t.value});var s=new t(this,e.extend([],e.fn.magicSuggest.defaults,n,r));o.data("magicSuggest",s),s.container.data("magicSuggest",s)}}),1===i.size()?i.data("magicSuggest"):i)},e.fn.magicSuggest.defaults={}}(jQuery);